/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.47
 * Generated at: 2026-01-08 09:42:55 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.views.monitoring;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;

public final class v2a_005fmon_005fmaterialperkontrak_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("\r\n");
      out.write("<style>\r\n");
      out.write("   /* CSS TABLE REKAP - SAMAKAN DENGAN TABEL Detail */\r\n");
      out.write("    #tablemon_upi {\r\n");
      out.write("        table-layout: auto; /* Sama seperti #dataModal table */\r\n");
      out.write("        font-size: 0.75rem; /* Sama dengan modal-body */\r\n");
      out.write("        width: 100%;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    #tablemon_upi th,\r\n");
      out.write("    #tablemon_upi td {\r\n");
      out.write("        font-size: 0.7rem;      /* Sama seperti table detail */\r\n");
      out.write("        padding: 4px 6px;       /* Sama seperti table detail */\r\n");
      out.write("        white-space: nowrap;    /* Hindari wrap */\r\n");
      out.write("        overflow: hidden;\r\n");
      out.write("        text-overflow: ellipsis;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    #tablemon_upi th.sorting::after,\r\n");
      out.write("    #tablemon_upi th.sorting_asc::after,\r\n");
      out.write("    #tablemon_upi th.sorting_desc::after {\r\n");
      out.write("        display: none !important;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* Target wrapper DataTables untuk memastikan lebar 100% tidak terlampaui */\r\n");
      out.write("    #tablemon_upi_wrapper {\r\n");
      out.write("        width: 100%;\r\n");
      out.write("        max-width: 100%;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* Tambahan jika mau batas tinggi + scroll seperti modal */\r\n");
      out.write("    #tablemon_upi_wrapper .dataTables_scrollBody {\r\n");
      out.write("        max-height: 65vh;       /* Sesuaikan tinggi maksimal seperti modal */\r\n");
      out.write("        overflow-y: auto;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* CSS MODAL SHOW TABLE MONITORING Detail */\r\n");
      out.write("    #dataModal .modal-body {\r\n");
      out.write("        font-size: 0.75rem; /* Ukuran teks diperkecil */\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    #dataModal table th,\r\n");
      out.write("    #dataModal table td {\r\n");
      out.write("        font-size: 0.7rem;   /* Ukuran teks header dan isi tabel */\r\n");
      out.write("        padding: 4px 6px;    /* Padding dikurangi agar tidak terlalu lebar */\r\n");
      out.write("        white-space: nowrap; /* Hindari pemisahan baris */\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    #dataModal table {\r\n");
      out.write("        table-layout: auto; /* Gunakan auto agar kolom menyesuaikan konten */\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    #dataModal .datatable-container {\r\n");
      out.write("        max-height: 65vh;    /* Batasi tinggi agar bisa scroll */\r\n");
      out.write("        overflow-y: auto;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* Pastikan form-container relatif */\r\n");
      out.write("    .form-monitoring {\r\n");
      out.write("        position: relative;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    .datatable-container {\r\n");
      out.write("        overflow-x: auto;\r\n");
      out.write("        width: 100%;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* Buat spinner tetap di tengah form tapi transparan */\r\n");
      out.write("    .loading-overlay {\r\n");
      out.write("        position: absolute;\r\n");
      out.write("        top: 50%;\r\n");
      out.write("        left: 50%;\r\n");
      out.write("        transform: translate(-50%, -50%);\r\n");
      out.write("        z-index: 1050;\r\n");
      out.write("        text-align: center;\r\n");
      out.write("        font-size: 0.95rem;\r\n");
      out.write("        /* Tidak ada background, padding, atau box */\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* tambah lebar large modal */\r\n");
      out.write("    .modal-xxl {\r\n");
      out.write("        max-width: 98% !important; /* Atur sesuai kebutuhan */\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* legenda tulisan hedar dan kotak  */\r\n");
      out.write("    .form-box {\r\n");
      out.write("        border: 1px solid #ddd;\r\n");
      out.write("        border-radius: 4px;\r\n");
      out.write("        padding: 20px;\r\n");
      out.write("        margin: 20px 0;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    .form-box legend {\r\n");
      out.write("        font-weight: bold;\r\n");
      out.write("        font-size: 1rem;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    .form-box fieldset {\r\n");
      out.write("        border: none;\r\n");
      out.write("        padding: 0;\r\n");
      out.write("        margin: 0;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    #tahun_laporan {\r\n");
      out.write("        text-transform: uppercase;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* ----------\r\n");
      out.write("       Spiner css\r\n");
      out.write("       ----------\r\n");
      out.write("    */\r\n");
      out.write("    #loadingSpinner {\r\n");
      out.write("        display: none;\r\n");
      out.write("        position: fixed;\r\n");
      out.write("        top: 20%;\r\n");
      out.write("        left: 50%;\r\n");
      out.write("        transform: translate(-50%, 0);\r\n");
      out.write("        z-index: 9999;\r\n");
      out.write("        /* background-color: rgba(255, 255, 255, 0.7); */\r\n");
      out.write("        padding: 20px 30px;\r\n");
      out.write("        border-radius: 6px;\r\n");
      out.write("        /* box-shadow: 0 0 10px rgba(0,0,0,0.2); */\r\n");
      out.write("        text-align: center;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("    #loadingSpinner .spinner-content {\r\n");
      out.write("        text-align: center;\r\n");
      out.write("        font-size: 1.2rem;\r\n");
      out.write("        color: #333;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    .overlay-spinner {\r\n");
      out.write("        position: absolute;\r\n");
      out.write("        top: 40%;\r\n");
      out.write("        left: 45%;\r\n");
      out.write("        z-index: 1060;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* Semua header */\r\n");
      out.write("    #tablemon_upi thead th {\r\n");
      out.write("        text-align: center;\r\n");
      out.write("        vertical-align: middle;\r\n");
      out.write("        font-weight: 600;\r\n");
      out.write("        color: #ffffff;            /* teks putih */\r\n");
      out.write("        border-color: #7d7c7a;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* Warna dasar kuning */\r\n");
      out.write("    #tablemon_upi thead.hdr-yellow th {\r\n");
      out.write("        background-color: #6390cb;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* Optional: hover sorting DataTables tetap kontras */\r\n");
      out.write("    #tablemon_upi thead th.sorting,\r\n");
      out.write("    #tablemon_upi thead th.sorting_asc,\r\n");
      out.write("    #tablemon_upi thead th.sorting_desc {\r\n");
      out.write("        color: #ffffff !important;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* ===== SUBTOTAL ROW ===== */\r\n");
      out.write("    table.dataTable tbody tr.subtotal-row td {\r\n");
      out.write("        background-color: #fff7e6 !important;\r\n");
      out.write("        font-weight: 700;\r\n");
      out.write("        border-top: 2px solid #f0ad4e !important;\r\n");
      out.write("        border-bottom: 2px solid #f0ad4e !important;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* jaga garis vertikal */\r\n");
      out.write("    table.dataTable tbody tr.subtotal-row td:not(:last-child) {\r\n");
      out.write("        border-right: 1px solid #dee2e6 !important;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* üëâ indent tulisan TOTAL (¬± 5 spasi) */\r\n");
      out.write("    table.dataTable tbody tr.subtotal-row td:first-child {\r\n");
      out.write("        padding-left: 40px !important; /* ‚âà 5 spasi */\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("    /* CSS khusus untuk kolom subtotal angka */\r\n");
      out.write("    .subtotal-row td.stynumeric {\r\n");
      out.write("        text-align: right;\r\n");
      out.write("        padding-right: 8px; /* optional, supaya rapi */\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* üîµ garis penutup per NOMOR_KONTRAK_RINCI */\r\n");
      out.write("    /* üîµ START KONTRAK RINCI */\r\n");
      out.write("    tr.start-kontrak-row td {\r\n");
      out.write("        border-top: 2px dashed #43a047;\r\n");
      out.write("        padding: 10px 0;\r\n");
      out.write("        background: #f1f8e9;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    .start-kontrak-text {\r\n");
      out.write("        text-align: left;\r\n");
      out.write("        font-weight: bold;\r\n");
      out.write("        color: #2e7d32;\r\n");
      out.write("        letter-spacing: 1px;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* üî¥ END KONTRAK RINCI (SATU GARIS PENUTUP SAJA) */\r\n");
      out.write("    tr.end-kontrak-row td {\r\n");
      out.write("        border-top: 2px dashed #e53935;   /* merah */\r\n");
      out.write("        padding: 10px 0;\r\n");
      out.write("        background: #fdecea;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    .end-kontrak-text {\r\n");
      out.write("        text-align: left;\r\n");
      out.write("        font-weight: bold;\r\n");
      out.write("        color: #b71c1c;\r\n");
      out.write("        letter-spacing: 1px;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("</style>\r\n");
      out.write("\r\n");
      out.write("<!-- ‚úÖ Spinner Global untuk semua loading -->\r\n");
      out.write("<div id=\"spinnerOverlay\" style=\"display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:9999;\">\r\n");
      out.write("    <div class=\"spinner-border text-primary\" role=\"status\"></div>\r\n");
      out.write("</div>\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("<!-- Modal Large -->\r\n");
      out.write("<div class=\"modal fade\" id=\"dataModal\" tabindex=\"-1\" aria-labelledby=\"dataModalLabel\" aria-hidden=\"true\">\r\n");
      out.write("  <!-- <div class=\"modal-dialog modal-dialog-scrollable modal-xl\"> -->\r\n");
      out.write("  <div class=\"modal-dialog modal-dialog-scrollable modal-xl modal-xxl\">\r\n");
      out.write("    <div class=\"modal-content\">\r\n");
      out.write("        <div class=\"modal-header\">\r\n");
      out.write("            <h5 class=\"modal-title\" id=\"dataModalLabel\">Detail Data</h5>\r\n");
      out.write("            <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Tutup\"></button>\r\n");
      out.write("        </div>\r\n");
      out.write("        <div class=\"modal-body\" id=\"modalBody\">\r\n");
      out.write("            <!-- Tombol Export -->\r\n");
      out.write("            <div class=\"mb-2\">\r\n");
      out.write("                <button id=\"btnExportMonDftAllExcelOneSheet\" class=\"btn btn-success btn-export\">\r\n");
      out.write("                    <i class=\"fa fa-file-excel-o\"></i> Export Detail Per-UPI\r\n");
      out.write("                </button>\r\n");
      out.write("            </div>\r\n");
      out.write("        <div class=\"datatable-container\" style=\"overflow-x: auto;\">\r\n");
      out.write("        <table id=\"table_mondaf_provupi\" class=\"table table-bordered table-striped w-100\" width=\"100%\">\r\n");
      out.write("                <thead>\r\n");
      out.write("                <tr>\r\n");
      out.write("                    <th>NO</th>\r\n");
      out.write("                    <th>NOMOR_KONTRAK_RINCI</th>\r\n");
      out.write("                    <th>KATEGORI_PEMBANGUNAN</th>\r\n");
      out.write("                    <th>MATERIAL_GROUP</th>\r\n");
      out.write("                    <th>KODE_MATERIAL</th>\r\n");
      out.write("                    <th>PENGGUNAAN</th>\r\n");
      out.write("                    <th>NAMA_MATERIAL</th>\r\n");
      out.write("                    <th>VOLUME_RENCANA</th>\r\n");
      out.write("                    <th>VOLUME_TERPASANG</th>\r\n");
      out.write("                    <th>SATUAN</th>\r\n");
      out.write("                </tr>\r\n");
      out.write("                </thead>\r\n");
      out.write("            <tbody>\r\n");
      out.write("            </tbody>\r\n");
      out.write("          </table>\r\n");
      out.write("        </div>          \r\n");
      out.write("      </div>\r\n");
      out.write("      <div class=\"modal-footer\">\r\n");
      out.write("        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Tutup</button>\r\n");
      out.write("      </div>\r\n");
      out.write("    </div>\r\n");
      out.write("  </div>\r\n");
      out.write("</div>\r\n");
      out.write("\r\n");
      out.write("<fieldset style=\"border: 1px solid #ccc; border-radius: 4px; padding: 1.25rem;\">\r\n");
      out.write("    <legend style=\"font-size: 0.95rem; font-weight: bold; padding: 0 0.75rem; width: auto;\">\r\n");
      out.write("        Monitoring - Material Terpasang PerKontrak LISA\r\n");
      out.write("    </legend>\r\n");
      out.write("\r\n");
      out.write("    <div class=\"container mt-1\">\r\n");
      out.write("        <div class=\"form-monitoring\">\r\n");
      out.write("            <form id=\"form-monitoring\">\r\n");
      out.write("                <div class=\"row align-items-end g-3 mb-2\">\r\n");
      out.write("                    <div class=\"col-md-4 col-lg-4\">\r\n");
      out.write("                        <label for=\"tahun_laporan\" class=\"form-label\">Tahun Laporan :</label>\r\n");
      out.write("                        <select id=\"tahun_laporan\" class=\"form-control\"></select>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("                <div class=\"row align-items-end g-3 mb-2\">\r\n");
      out.write("                    <div class=\"col-md-4 col-lg-4\">\r\n");
      out.write("                        <label for=\"vc_kdprov\" class=\"form-label\">Provinsi :</label>\r\n");
      out.write("                        <select id=\"vc_kdprov\" class=\"form-control\"> \r\n");
      out.write("                            <option value=\"\">-- Pilih Provinsi --</option>'\r\n");
      out.write("                        </select>\r\n");
      out.write("                    </div>\r\n");
      out.write("                    <div class=\"col-md-4 col-lg-4\">\r\n");
      out.write("                        <label for=\"vc_kdkab\" class=\"form-label\">Kabupaten :</label>\r\n");
      out.write("                        <select id=\"vc_kdkab\" class=\"form-control\" disabled=\"true\"> \r\n");
      out.write("                             <option value=\"\">-- Pilih Kabupaten/Kota --</option>'\r\n");
      out.write("                        </select>\r\n");
      out.write("                    </div>\r\n");
      out.write("\r\n");
      out.write("                    <div class=\"col-md-4 col-lg-4\">\r\n");
      out.write("                        <label for=\"vc_kdkec\" class=\"form-label\">Kecamatan :</label>\r\n");
      out.write("                        <select id=\"vc_kdkec\" class=\"form-control\" disabled=\"true\"> \r\n");
      out.write("                           <option value=\"\">-- Pilih Kecamatan --</option>'\r\n");
      out.write("                        </select>\r\n");
      out.write("                    </div>\r\n");
      out.write("\r\n");
      out.write("                     <div class=\"col-md-4 col-lg-4\">\r\n");
      out.write("                        <label for=\"vc_kdkel\" class=\"form-label\">Desa/Kelurahan :</label>\r\n");
      out.write("                        <select id=\"vc_kdkel\" class=\"form-control\" disabled=\"true\"> \r\n");
      out.write("                             <option value=\"\">-- Pilih Desa/Kelurahan --</option>'\r\n");
      out.write("                        </select>\r\n");
      out.write("                    </div>\r\n");
      out.write("                    \r\n");
      out.write("                    <!-- Tombol Tampilkan -->\r\n");
      out.write("                    <div class=\"col-md-2\">\r\n");
      out.write("                        <label class=\"form-label d-none d-md-block\">&nbsp;</label> <!-- Spacer agar sejajar -->\r\n");
      out.write("                        <button id=\"btnTampil\" type=\"button\" class=\"btn btn-primary w-100\">\r\n");
      out.write("                            <i class=\"bi bi-search\"></i> Tampilkan\r\n");
      out.write("                        </button>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("\r\n");
      out.write("                <div class=\"row align-items-end g-3 mb-2\"></div>\r\n");
      out.write("                \r\n");
      out.write("            </form>\r\n");
      out.write("        </div>\r\n");
      out.write("\r\n");
      out.write("        <div class=\"mt-4\">\r\n");
      out.write("           <!-- Tombol export buatan sendiri -->\r\n");
      out.write("            <div class=\"mb-2\">\r\n");
      out.write("                <button id=\"btnExportMonRkpAllExcel\" class=\"btn btn-success btn-export\" style=\"display: none;\">\r\n");
      out.write("                    <i class=\"fa fa-file-excel-o\"></i> Download Excel\r\n");
      out.write("                </button>\r\n");
      out.write("                <button id=\"btnExportMonRkpAllExcel2\" class=\"btn btn-success btn-export\" >\r\n");
      out.write("                    <i class=\"fa fa-file-excel-o\"></i> Download Excel Rekap\r\n");
      out.write("                </button>\r\n");
      out.write("            </div>\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("            <div class=\"datatable-container\">\r\n");
      out.write("                <div class=\"datatable-scroll-wrapper\" style=\"overflow-x: auto;\">\r\n");
      out.write("                    <table id=\"tablemon_upi\" class=\"datatable-main table table-bordered table-striped\">\r\n");
      out.write("                        <!-- <thead>\r\n");
      out.write("                            <tr>\r\n");
      out.write("                                <th>NO</th>\r\n");
      out.write("                                <th>TAHUN</th>\r\n");
      out.write("                                <th>KD_PROV</th>\r\n");
      out.write("                                <th>PROVINSI</th>\r\n");
      out.write("                                <th>JTR_RENCANA</th>\r\n");
      out.write("                                <th>JTM_RENCANA</th>\r\n");
      out.write("                                <th>GRD_RENCANA</th>\r\n");
      out.write("                                <th>JTR_WO</th>\r\n");
      out.write("                                <th>JTM_WO</th>\r\n");
      out.write("                                <th>GRD_WO</th>\r\n");
      out.write("                            </tr>\r\n");
      out.write("                        </thead> -->\r\n");
      out.write("                        <thead class=\"hdr-yellow\">\r\n");
      out.write("                            <tr>\r\n");
      out.write("                                <th>NOMOR</th>\r\n");
      out.write("                                <th>NOMOR_KONTRAK_RINCI</th>\r\n");
      out.write("                                <!-- <th>KD_PROV</th> -->\r\n");
      out.write("                                <th>PROVINSI</th>\r\n");
      out.write("                                <!-- <th>KD_KAB</th> -->\r\n");
      out.write("                                <th>KABUPATENKOTA</th>\r\n");
      out.write("                                <!-- <th>KD_KEC</th> -->\r\n");
      out.write("                                <th>KECAMATAN</th>\r\n");
      out.write("                                <!-- <th>KD_KEL</th> -->\r\n");
      out.write("                                <th>DESAKELURAHAN</th>\r\n");
      out.write("                                <th>ID_WO_PETUGAS</th>\r\n");
      out.write("                                <th>LONGITUDE_LOKASI</th>\r\n");
      out.write("                                <th>LATITUDE_LOKASI</th>\r\n");
      out.write("                                <th>TGL_SELESAI</th>\r\n");
      out.write("                                <th>STATUS</th>\r\n");
      out.write("                                <!-- <th>PATH_FOTO1</th>\r\n");
      out.write("                                <th>PATH_FOTO2</th>\r\n");
      out.write("                                <th>PATH_FOTO3</th>\r\n");
      out.write("                                <th>PATH_FOTO4</th>\r\n");
      out.write("                                <th>PATH_FOTO5</th>\r\n");
      out.write("                                <th>PATH_FOTO6</th>\r\n");
      out.write("                                <th>PATH_FOTO7</th> -->\r\n");
      out.write("                            </tr>\r\n");
      out.write("                        </thead>\r\n");
      out.write("                        <tbody></tbody>\r\n");
      out.write("                    </table>\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("    </div>\r\n");
      out.write("</fieldset>\r\n");
      out.write("\r\n");
      out.write("<script>\r\n");
      out.write("    $(document).ready(function () {\r\n");
      out.write("        function getContextPath() {\r\n");
      out.write("            return window.location.pathname.substring(0, window.location.pathname.indexOf(\"/\", 2));\r\n");
      out.write("        }       \r\n");
      out.write("\r\n");
      out.write("        // Ambil tahun sekarang\r\n");
      out.write("        const currentYear = new Date().getFullYear();\r\n");
      out.write("\r\n");
      out.write("        // Hitung range\r\n");
      out.write("        const startYear = currentYear - 5;\r\n");
      out.write("        const endYear = currentYear + 5;\r\n");
      out.write("\r\n");
      out.write("        const select = document.getElementById(\"tahun_laporan\");\r\n");
      out.write("\r\n");
      out.write("        // Generate dropdown tahun\r\n");
      out.write("        for (let y = startYear; y <= endYear; y++) {\r\n");
      out.write("            const opt = document.createElement(\"option\");\r\n");
      out.write("            opt.value = y;\r\n");
      out.write("            opt.textContent = y;\r\n");
      out.write("\r\n");
      out.write("            // Set default tahun sekarang\r\n");
      out.write("            if (y === currentYear) {\r\n");
      out.write("                opt.selected = true;\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            select.appendChild(opt);\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        let detailFilterParams = {};\r\n");
      out.write("\r\n");
      out.write("        // memembat format number digit\r\n");
      out.write("        function formatNumber(value, fractionDigits = 2) {\r\n");
      out.write("            if (value == null || value === '') return '';\r\n");
      out.write("            const number = parseFloat(value);\r\n");
      out.write("            if (isNaN(number)) return value;\r\n");
      out.write("            return number.toLocaleString('id-ID', {\r\n");
      out.write("                minimumFractionDigits: fractionDigits,\r\n");
      out.write("                maximumFractionDigits: fractionDigits\r\n");
      out.write("            });\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        // -------------------------\r\n");
      out.write("        // ) Init: load Master Provinsi / Kabpupaten\r\n");
      out.write("        // -------------------------\r\n");
      out.write("        // Begin Main ------------\r\n");
      out.write("        loadMstProvinsi();  \r\n");
      out.write("\r\n");
      out.write("        document.getElementById('vc_kdprov').addEventListener('change', function () {\r\n");
      out.write("            const vkdprov = this.value;\r\n");
      out.write("\r\n");
      out.write("            if (!vkdprov) {\r\n");
      out.write("                // jika pilih \"-- Pilih Provinsi --\"\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("            const kabSelect  = document.getElementById('vc_kdkab');\r\n");
      out.write("            const kecSelect  = document.getElementById('vc_kdkec');\r\n");
      out.write("            const kelSelect  = document.getElementById('vc_kdkel');\r\n");
      out.write("            kabSelect.disabled = false;\r\n");
      out.write("            kecSelect.disabled = true;\r\n");
      out.write("            kecSelect.innerHTML = '<option value=\"\">-- Pilih Kecamatan --</option>';\r\n");
      out.write("            kelSelect.disabled = true;\r\n");
      out.write("            kelSelect.innerHTML = '<option value=\"\">-- Pilih Desa/Kelurahan --</option>';\r\n");
      out.write("            loadMstKabupatenKota(vkdprov);\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        document.getElementById('vc_kdkab').addEventListener('change', function () {\r\n");
      out.write("            const vkdprov = document.getElementById('vc_kdprov').value; // ‚¨ÖÔ∏è INI\r\n");
      out.write("            const vkdkab  = this.value;\r\n");
      out.write("\r\n");
      out.write("            if (!vkdprov || !vkdkab) {\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            const kabSelect = document.getElementById('vc_kdkec');\r\n");
      out.write("            const kelSelect  = document.getElementById('vc_kdkel');\r\n");
      out.write("            kabSelect.disabled = false;\r\n");
      out.write("            kabSelect.disabled = false;\r\n");
      out.write("            kelSelect.disabled = true;\r\n");
      out.write("            kelSelect.innerHTML = '<option value=\"\">-- Pilih Desa/Kelurahan --</option>';\r\n");
      out.write("\r\n");
      out.write("            loadMstKecamatan(vkdprov, vkdkab);\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        document.getElementById('vc_kdkec').addEventListener('change', function () {\r\n");
      out.write("            const vkdprov   = document.getElementById('vc_kdprov').value;\r\n");
      out.write("            const vkdkab    = document.getElementById('vc_kdkab').value;\r\n");
      out.write("            const vkdkec    = this.value;\r\n");
      out.write("\r\n");
      out.write("            if (!vkdprov || !vkdkab || !vkdkec) {\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            const kelSelect = document.getElementById('vc_kdkel');\r\n");
      out.write("            kelSelect.disabled = false;\r\n");
      out.write("\r\n");
      out.write("            loadMstDesaKelurahan(vkdprov, vkdkab, vkdkec);\r\n");
      out.write("        });\r\n");
      out.write("        \r\n");
      out.write("        // END Main ------------\r\n");
      out.write("\r\n");
      out.write("        //B.1 Get MstProvinsi\r\n");
      out.write("        async function loadMstProvinsi() {\r\n");
      out.write("            console.log(\"üîÑ Memuat daftar Provinsi...\");\r\n");
      out.write("\r\n");
      out.write("            const params = new URLSearchParams();\r\n");
      out.write("            params.append('act', 'getMstProvinsi');\r\n");
      out.write("\r\n");
      out.write("            try {\r\n");
      out.write("                const res = await fetch(getContextPath() + '/mst-global', {\r\n");
      out.write("                    method: 'POST',\r\n");
      out.write("                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n");
      out.write("                    body: params.toString()\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                if (!res.ok) throw new Error(\"HTTP Error \" + res.status);\r\n");
      out.write("\r\n");
      out.write("                const json = await res.json();\r\n");
      out.write("\r\n");
      out.write("                const provSelect = document.getElementById('vc_kdprov');\r\n");
      out.write("                const kabSelect  = document.getElementById('vc_kdkab');\r\n");
      out.write("\r\n");
      out.write("                // reset provinsi\r\n");
      out.write("                provSelect.innerHTML = '<option value=\"\">-- Pilih Provinsi --</option>';\r\n");
      out.write("\r\n");
      out.write("                if (json.status === 'success' && Array.isArray(json.data)) {\r\n");
      out.write("\r\n");
      out.write("                    json.data.forEach(diswil => {\r\n");
      out.write("                        const opt = document.createElement('option');\r\n");
      out.write("                        opt.value = diswil.KODE;\r\n");
      out.write("                        opt.textContent = diswil.PROVINSI;\r\n");
      out.write("                        provSelect.appendChild(opt);\r\n");
      out.write("                    });\r\n");
      out.write("\r\n");
      out.write("                    // ‚¨ÖÔ∏è INI KUNCI PERBAIKAN\r\n");
      out.write("                    kabSelect.disabled = true;\r\n");
      out.write("\r\n");
      out.write("                    console.log(\"‚úÖ Provinsi berhasil dimuat:\", json.data.length, \"data\");\r\n");
      out.write("                } else {\r\n");
      out.write("                    const opt = document.createElement('option');\r\n");
      out.write("                    opt.textContent = \"Tidak ada data Provinsi\";\r\n");
      out.write("                    provSelect.appendChild(opt);\r\n");
      out.write("                }\r\n");
      out.write("            } catch (err) {\r\n");
      out.write("                console.error(\"‚ùå Error JS:\", err.message);\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        //B.2 Get MstKabupatenKota\r\n");
      out.write("        async function loadMstKabupatenKota(vkdprov) {\r\n");
      out.write("            console.log(\"üîÑ Memuat daftar Kabupaten/Kota...\");\r\n");
      out.write("\r\n");
      out.write("            const params = new URLSearchParams();\r\n");
      out.write("            params.append('act', 'getMstKabuptenKota');\r\n");
      out.write("            params.append('vkdprov', vkdprov);\r\n");
      out.write("\r\n");
      out.write("            try {\r\n");
      out.write("                const res = await fetch(getContextPath() + '/mst-global', {\r\n");
      out.write("                    method: 'POST',\r\n");
      out.write("                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n");
      out.write("                    body: params.toString()\r\n");
      out.write("                });\r\n");
      out.write("                if (!res.ok) throw new Error(\"HTTP Error \" + res.status);\r\n");
      out.write("                const json = await res.json();\r\n");
      out.write("\r\n");
      out.write("                const select = document.getElementById('vc_kdkab');\r\n");
      out.write("                select.innerHTML = '<option value=\"\">-- Pilih Kabupaten/Kota --</option>';\r\n");
      out.write("\r\n");
      out.write("                if (json.status === 'success' && Array.isArray(json.data)) {\r\n");
      out.write("                    json.data.forEach(diswil => {\r\n");
      out.write("                        const opt = document.createElement('option');\r\n");
      out.write("                        opt.value = diswil.KODE;\r\n");
      out.write("                        opt.textContent = diswil.KABUPATEN;\r\n");
      out.write("                        select.appendChild(opt);\r\n");
      out.write("                    });\r\n");
      out.write("                    console.log(\"‚úÖ Kabupaten/Kota berhasil dimuat:\", json.data.length, \"data\");\r\n");
      out.write("                } else {\r\n");
      out.write("                    const opt = document.createElement('option');\r\n");
      out.write("                    opt.textContent = \"Tidak ada data DISWIL\";\r\n");
      out.write("                    select.appendChild(opt);\r\n");
      out.write("                }\r\n");
      out.write("            } catch (err) {\r\n");
      out.write("                console.error(\"‚ùå Error JS:\", err.message);\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        //B.3 Get MstKecamatan\r\n");
      out.write("        async function loadMstKecamatan(vkdprov, vkdkab) {\r\n");
      out.write("            console.log(\"üîÑ Memuat daftar Kecamatan...\");\r\n");
      out.write("\r\n");
      out.write("            const params = new URLSearchParams();\r\n");
      out.write("            params.append('act', 'GetMstKecamatan');\r\n");
      out.write("            params.append('vkdprov', vkdprov);\r\n");
      out.write("            params.append('vkdkab', vkdkab);\r\n");
      out.write("\r\n");
      out.write("            try {\r\n");
      out.write("                const res = await fetch(getContextPath() + '/mst-global', {\r\n");
      out.write("                    method: 'POST',\r\n");
      out.write("                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n");
      out.write("                    body: params.toString()\r\n");
      out.write("                });\r\n");
      out.write("                if (!res.ok) throw new Error(\"HTTP Error \" + res.status);\r\n");
      out.write("                const json = await res.json();\r\n");
      out.write("\r\n");
      out.write("                const select = document.getElementById('vc_kdkec');\r\n");
      out.write("                select.innerHTML = '<option value=\"\">-- Pilih Kecamatan --</option>';\r\n");
      out.write("\r\n");
      out.write("                if (json.status === 'success' && Array.isArray(json.data)) {\r\n");
      out.write("                    json.data.forEach(diswil => {\r\n");
      out.write("                        const opt = document.createElement('option');\r\n");
      out.write("                        opt.value = diswil.KODE;\r\n");
      out.write("                        opt.textContent = diswil.KECAMATAN;\r\n");
      out.write("                        select.appendChild(opt);\r\n");
      out.write("                    });\r\n");
      out.write("                    console.log(\"‚úÖ Kecamatan berhasil dimuat:\", json.data.length, \"data\");\r\n");
      out.write("                } else {\r\n");
      out.write("                    const opt = document.createElement('option');\r\n");
      out.write("                    opt.textContent = \"Tidak ada data DISWIL\";\r\n");
      out.write("                    select.appendChild(opt);\r\n");
      out.write("                }\r\n");
      out.write("            } catch (err) {\r\n");
      out.write("                console.error(\"‚ùå Error JS:\", err.message);\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("         //B.4 Get MstDesaKelurahan\r\n");
      out.write("        async function loadMstDesaKelurahan(vkdprov, vkdkab, vkdkec) {\r\n");
      out.write("            console.log(\"üîÑ Memuat daftar Kecamatan...\");\r\n");
      out.write("\r\n");
      out.write("            const params = new URLSearchParams();\r\n");
      out.write("            params.append('act', 'GetMstDesaKelurahan');\r\n");
      out.write("            params.append('vkdprov', vkdprov);\r\n");
      out.write("            params.append('vkdkab', vkdkab);\r\n");
      out.write("            params.append('vkdkec', vkdkec);\r\n");
      out.write("\r\n");
      out.write("            try {\r\n");
      out.write("                const res = await fetch(getContextPath() + '/mst-global', {\r\n");
      out.write("                    method: 'POST',\r\n");
      out.write("                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n");
      out.write("                    body: params.toString()\r\n");
      out.write("                });\r\n");
      out.write("                if (!res.ok) throw new Error(\"HTTP Error \" + res.status);\r\n");
      out.write("                const json = await res.json();\r\n");
      out.write("\r\n");
      out.write("                const select = document.getElementById('vc_kdkel');\r\n");
      out.write("                select.innerHTML = '<option value=\"\">-- Pilih Desa/Kelurahan --</option>';\r\n");
      out.write("\r\n");
      out.write("                if (json.status === 'success' && Array.isArray(json.data)) {\r\n");
      out.write("                    json.data.forEach(diswil => {\r\n");
      out.write("                        const opt = document.createElement('option');\r\n");
      out.write("                        opt.value = diswil.KODE;\r\n");
      out.write("                        opt.textContent = diswil.KELURAHAN;\r\n");
      out.write("                        select.appendChild(opt);\r\n");
      out.write("                    });\r\n");
      out.write("                    console.log(\"‚úÖ Kecamatan berhasil dimuat:\", json.data.length, \"data\");\r\n");
      out.write("                } else {\r\n");
      out.write("                    const opt = document.createElement('option');\r\n");
      out.write("                    opt.textContent = \"Tidak ada data DISWIL\";\r\n");
      out.write("                    select.appendChild(opt);\r\n");
      out.write("                }\r\n");
      out.write("            } catch (err) {\r\n");
      out.write("                console.error(\"‚ùå Error JS:\", err.message);\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("        // ---------------------------------------------------------------------------------------------\r\n");
      out.write("        // 1A-1) Tampilkan monitoring Rekap\r\n");
      out.write("        // ---------------------------------------------------------------------------------------------\r\n");
      out.write("        var table = $('#tablemon_upi').DataTable({\r\n");
      out.write("            processing: false,\r\n");
      out.write("            serverSide: true,\r\n");
      out.write("            scrollX: false,\r\n");
      out.write("            paging: false, // MATIKAN PAGING\r\n");
      out.write("            stripeClasses: [], // Nonaktifkan efek baris selang-seling\r\n");
      out.write("            searching: false, \r\n");
      out.write("            autoWidth: false,\r\n");
      out.write("            ajax: {\r\n");
      out.write("                url:  getContextPath() + '/mon-pengerjaan-perkontrak',\r\n");
      out.write("                type: 'POST',\r\n");
      out.write("                data: function (d) {\r\n");
      out.write("                    d.vtahun_laporan    = $('#tahun_laporan').val();// pastikan pakai '#'!\r\n");
      out.write("                    d.vkdprov           = $('#vc_kdprov').val();\r\n");
      out.write("                    d.vkdkab            = $('#vc_kdkab').val();\r\n");
      out.write("                    d.vkdkec            = $('#vc_kdkec').val();\r\n");
      out.write("                    d.vkdkel            = $('#vc_kdkel').val();\r\n");
      out.write("                }\r\n");
      out.write("            },\r\n");
      out.write("            columns: [\r\n");
      out.write("                {\r\n");
      out.write("                    data: null,\r\n");
      out.write("                    render: function (data, type, row, meta) {\r\n");
      out.write("                        if (row.KD_PROV !== null && row.KD_PROV !== undefined) {\r\n");
      out.write("                            return meta.row + 1 + meta.settings._iDisplayStart;\r\n");
      out.write("                        } else {\r\n");
      out.write("                            return ''; // atau bisa juga 'N/A' atau '-'\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("                },\r\n");
      out.write("                {data:'NOMOR_KONTRAK_RINCI',defaultContent:''},\r\n");
      out.write("                // {data:'KD_PROV',defaultContent:''},\r\n");
      out.write("                {data:'PROVINSI',defaultContent:'', render: function(data, type, row){\r\n");
      out.write("                        return (row.KD_PROV ?? '') + ' - ' + (row.PROVINSI ?? '');\r\n");
      out.write("                }},\r\n");
      out.write("                // {data:'KD_KAB',defaultContent:''},\r\n");
      out.write("                {data:null,defaultContent:'', render: function(data, type, row){\r\n");
      out.write("                        return (row.KD_KAB ?? '') + ' - ' + (row.KABUPATENKOTA ?? '');\r\n");
      out.write("                }},\r\n");
      out.write("                // {data:'KD_KEC',defaultContent:''},\r\n");
      out.write("                {data:null,defaultContent:'', render: function(data, type, row){\r\n");
      out.write("                        return (row.KD_KEC ?? '') + ' - ' + (row.KECAMATAN ?? '');\r\n");
      out.write("                }},\r\n");
      out.write("                // {data:'KD_KEL',defaultContent:''},\r\n");
      out.write("                {data:null,defaultContent:'', render: function(data, type, row){\r\n");
      out.write("                        return (row.KD_KEL ?? '') + ' - ' + (row.DESAKELURAHAN ?? '');\r\n");
      out.write("                }},\r\n");
      out.write("                {data:'ID_WO_PETUGAS',defaultContent:''},\r\n");
      out.write("                {data:'LONGITUDE_LOKASI',defaultContent:''},\r\n");
      out.write("                {data:'LATITUDE_LOKASI',defaultContent:''},\r\n");
      out.write("                {data:'TGL_SELESAI',defaultContent:''},\r\n");
      out.write("                {data:'STATUS',defaultContent:''},\r\n");
      out.write("                // {data:'PATH_FOTO1',defaultContent:''},\r\n");
      out.write("                // {data:'PATH_FOTO2',defaultContent:''},\r\n");
      out.write("                // {data:'PATH_FOTO3',defaultContent:''},\r\n");
      out.write("                // {data:'PATH_FOTO4',defaultContent:''},\r\n");
      out.write("                // {data:'PATH_FOTO5',defaultContent:''},\r\n");
      out.write("                // {data:'PATH_FOTO6',defaultContent:''},\r\n");
      out.write("                // {data:'PATH_FOTO7',defaultContent:''}\r\n");
      out.write("            ],\r\n");
      out.write("\r\n");
      out.write("            drawCallback: function () {\r\n");
      out.write("                $('#tablemon_upi thead th').addClass('text-center');\r\n");
      out.write("            },\r\n");
      out.write("           columnDefs: [\r\n");
      out.write("                { targets: '_all', className: 'dt-center' },\r\n");
      out.write("                { targets: 0, className: 'dt-body-right', orderable: false, width: '5px' },      \r\n");
      out.write("                { targets: 1, className: 'dt-body-center', width: '5px' },                         \r\n");
      out.write("                { targets: 2, className: 'dt-body-center', width: '5px' },                       \r\n");
      out.write("                // { targets: 3, className: 'dt-body-center', width: '50px' },                         \r\n");
      out.write("                // { targets: 4, className: 'dt-body-center', width: '50px' },                        \r\n");
      out.write("                // { targets: 5, className: 'dt-body-center', width: '50px' },                        \r\n");
      out.write("                // { targets: 6, className: 'dt-body-center', width: '50px' },   \r\n");
      out.write("                // { targets: 7, className: 'dt-body-center', width: '50px' },                        \r\n");
      out.write("                // { targets: 8, className: 'dt-body-center', width: '50px' },                        \r\n");
      out.write("                // { targets: 9, className: 'dt-body-center', width: '50px' },                         \r\n");
      out.write("            ],\r\n");
      out.write("            createdRow: function (row, data, dataIndex) {\r\n");
      out.write("            //    if (data.URUT == 5) {\r\n");
      out.write("            //         $('td', row).css({\r\n");
      out.write("            //             'font-weight': 'bold',\r\n");
      out.write("            //             // 'background-color': 'black',\r\n");
      out.write("            //             // 'color': 'white'\r\n");
      out.write("            //         });\r\n");
      out.write("            //     }\r\n");
      out.write("\r\n");
      out.write("                $('td', row).each(function (colIndex) {\r\n");
      out.write("\r\n");
      out.write("                    const columnDef = table.settings()[0].aoColumns[colIndex];\r\n");
      out.write("                    const columnName = columnDef.data;\r\n");
      out.write("                    if (!columnName) return;\r\n");
      out.write("\r\n");
      out.write("                    const cellValue = data[columnName];\r\n");
      out.write("                    const allowedColumns = ['NOMOR_KONTRAK_RINCI' ];\r\n");
      out.write("\r\n");
      out.write("                    if (\r\n");
      out.write("                        allowedColumns.includes(columnName) &&\r\n");
      out.write("                        typeof cellValue === 'string' &&\r\n");
      out.write("                        cellValue.trim() !== '' \r\n");
      out.write("                    ) {\r\n");
      out.write("                        // ===== RESET STYLE & CLICK (WAJIB) =====\r\n");
      out.write("                        $(this)\r\n");
      out.write("                            .removeClass('dt-clickable-bold')\r\n");
      out.write("                            .css({\r\n");
      out.write("                                cursor: 'default',\r\n");
      out.write("                                'text-decoration': 'none',\r\n");
      out.write("                                color: '',\r\n");
      out.write("                                'font-weight': 'bold',\r\n");
      out.write("                            })\r\n");
      out.write("                            .off('click');\r\n");
      out.write("\r\n");
      out.write("                        // ==============================\r\n");
      out.write("                        // Reset style & click (WAJIB)\r\n");
      out.write("                        // ==============================\r\n");
      out.write("                        $(this)\r\n");
      out.write("                            .css({\r\n");
      out.write("                                cursor: 'default',\r\n");
      out.write("                                'text-decoration': 'none',\r\n");
      out.write("                                'font-weight': 'normal',\r\n");
      out.write("                                color: ''\r\n");
      out.write("                            })\r\n");
      out.write("                            .off('click');\r\n");
      out.write("\r\n");
      out.write("                        // ==============================\r\n");
      out.write("                        // Aktifkan underline & modal\r\n");
      out.write("                        // ==============================\r\n");
      out.write("                        $(this).css({\r\n");
      out.write("                            cursor: 'pointer',\r\n");
      out.write("                            'text-decoration': 'underline',\r\n");
      out.write("                            'font-weight': 'bold',\r\n");
      out.write("                            color: 'blue'\r\n");
      out.write("                        }).on('click', function () {\r\n");
      out.write("\r\n");
      out.write("                            $('#xtahun_laporan').val(data.TAHUN);\r\n");
      out.write("                            $('#xkd_prov').val(data.KD_PROV);\r\n");
      out.write("\r\n");
      out.write("                            detailFilterParams = {\r\n");
      out.write("                                vtahun_laporan     : data.TAHUN ?? detailFilterParams.vtahun_laporan,\r\n");
      out.write("                                vkdprov            : data.KD_PROV,\r\n");
      out.write("                                vkdkab             : data.KD_KAB,\r\n");
      out.write("                                vkdkec             : data.KD_KEC,\r\n");
      out.write("                                vkdkel             : data.KD_KEL,\r\n");
      out.write("                                vnomor_kontrak_rinci: data.NOMOR_KONTRAK_RINCI\r\n");
      out.write("                            };\r\n");
      out.write("\r\n");
      out.write("                            console.log('Updated filter params:', detailFilterParams);\r\n");
      out.write("                            $('#dataModal').modal('show');\r\n");
      out.write("                        });\r\n");
      out.write("\r\n");
      out.write("                    }\r\n");
      out.write("                });\r\n");
      out.write("            },\r\n");
      out.write("            // dom: 'lfrtip'\r\n");
      out.write("            dom: 'Bfrtip',\r\n");
      out.write("            buttons: [\r\n");
      out.write("                    {\r\n");
      out.write("                        extend: 'excelHtml5',\r\n");
      out.write("                        title: 'REKAP_PENGERJAAN_PEMASANGAN_' + $('#tahun_laporan').val(),\r\n");
      out.write("                        className: 'd-none',\r\n");
      out.write("                        exportOptions: {\r\n");
      out.write("                            format: {\r\n");
      out.write("                                body: function (data, row, column, node) {\r\n");
      out.write("                                    // Ambil semua kolom yang menggunakan formatNumber\r\n");
      out.write("                                    // const columnsRaw = [5,6,7,8,9,10,11]; // indeks kolom sesuai urutan kolom PLN_IDPEL - SELISIH_RPTAG\r\n");
      out.write("\r\n");
      out.write("                                    // Jika kolom termasuk dalam Detail, hilangkan format ribuan (misal: \"1.000.000\" jadi \"1000000\")\r\n");
      out.write("                                    if (columnsRaw.includes(column)) {\r\n");
      out.write("                                        if (typeof data === 'string') {\r\n");
      out.write("                                            // Hilangkan titik ribuan dan koma desimal jika perlu\r\n");
      out.write("                                            return data.replace(/\\./g, '').replace(/,/g, '');\r\n");
      out.write("                                        }\r\n");
      out.write("                                        return data;\r\n");
      out.write("                                    }\r\n");
      out.write("                                    return data;\r\n");
      out.write("                                }\r\n");
      out.write("                            }\r\n");
      out.write("                        },\r\n");
      out.write("                        customize: function (xlsx) {\r\n");
      out.write("                            const sheet = xlsx.xl.worksheets['sheet1.xml'];\r\n");
      out.write("                            const sheetData = $('sheetData', sheet);\r\n");
      out.write("\r\n");
      out.write("                            const now = new Date();\r\n");
      out.write("                            const dd = String(now.getDate()).padStart(2, '0');\r\n");
      out.write("                            const mm = String(now.getMonth() + 1).padStart(2, '0');\r\n");
      out.write("                            const yyyy = now.getFullYear();\r\n");
      out.write("                            const hh = String(now.getHours()).padStart(2, '0');\r\n");
      out.write("                            const mi = String(now.getMinutes()).padStart(2, '0');\r\n");
      out.write("                            const ss = String(now.getSeconds()).padStart(2, '0');\r\n");
      out.write("                            const timestamp = dd+\"/\"+mm+\"/\"+yyyy+\" \"+hh+\":\"+mi+\":\"+ss;\r\n");
      out.write("                            const judul = \"_REKAP_\" + $('#tahun_laporan').val();\r\n");
      out.write("\r\n");
      out.write("                            // Tambahkan judul dan timestamp jika dibutuhkan\r\n");
      out.write("                            // ...\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("                ]            \r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        // Tampilkan spinnerOverlay saat DataTables mulai load data\r\n");
      out.write("        table.on('preXhr.dt', function () {\r\n");
      out.write("           $('#spinnerOverlay').show();  \r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        // Sembunyikan spinnerOverlay setelah DataTables selesai load data\r\n");
      out.write("        table.on('xhr.dt', function () {\r\n");
      out.write("            $('#spinnerOverlay').hide();    // Saat selesai\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        $('#btnTampil').on('click', function () {\r\n");
      out.write("            if ((!$('#tahun_laporan').val()) || (!$('#vc_kdprov').val())) {\r\n");
      out.write("                alert(\"Silakan pilih Tahun Laporan dan Provinsi terlebih dahulu!\");\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            $('#spinnerOverlay').show();   // hanya tampilkan overlay modal\r\n");
      out.write("            table.ajax.reload();\r\n");
      out.write("        });\r\n");
      out.write("         \r\n");
      out.write("        // ---------------------------------------------------------------------------------------------\r\n");
      out.write("        // 1A-2) Ekspor halaman Monitoring Rekap ke Excel\r\n");
      out.write("        // ---------------------------------------------------------------------------------------------\r\n");
      out.write("        // $('#btnExportMonRkpAllExcel').on('click', function () {\r\n");
      out.write("        //     table.button('.buttons-excel').trigger();\r\n");
      out.write("        // });\r\n");
      out.write("\r\n");
      out.write("        async function exportRekapPengerjaanExcel(vtahun_laporan) {\r\n");
      out.write("\r\n");
      out.write("            if (!vtahun_laporan) {\r\n");
      out.write("                alert(\"Silakan isi Tahun Laporan terlebih dahulu.\");\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            const btn = $('#btnExportMonRkpAllExcel2');\r\n");
      out.write("            $('#spinnerOverlay').show();\r\n");
      out.write("            btn.prop('disabled', true).text(\"Memuat... (0 data)\");\r\n");
      out.write("\r\n");
      out.write("            try {\r\n");
      out.write("\r\n");
      out.write("                // ============================================================\r\n");
      out.write("                // 1. LOAD DATA\r\n");
      out.write("                // ============================================================\r\n");
      out.write("                let allData = [];\r\n");
      out.write("\r\n");
      out.write("                const headers = [\r\n");
      out.write("                    \"NO\",\r\n");
      out.write("                    \"TAHUN\",\r\n");
      out.write("                    \"KD_PROV\",\r\n");
      out.write("                    \"PROVINSI\",\r\n");
      out.write("                    \"JTR_RENCANA\", \r\n");
      out.write("                    \"JTM_RENCANA\",\r\n");
      out.write("                    \"GRD_RENCANA\",\r\n");
      out.write("                    \"JTR_WO\", \r\n");
      out.write("                    \"JTM_WO\", \r\n");
      out.write("                    \"GRD_WO\",\r\n");
      out.write("                    \"JTR_PROGRES\", \r\n");
      out.write("                    \"JTM_PROGRES\", \r\n");
      out.write("                    \"GRD_PROGRES\", \r\n");
      out.write("                    \"JTR_FINAL\", \r\n");
      out.write("                    \"JTM_FINAL\", \r\n");
      out.write("                    \"GRD_FINAL\", \r\n");
      out.write("                    \"JTR_PROSEN\", \r\n");
      out.write("                    \"JTM_PROSEN\", \r\n");
      out.write("                    \"GRD_PROSEN\"\r\n");
      out.write("                ];\r\n");
      out.write("\r\n");
      out.write("                const params = new URLSearchParams();\r\n");
      out.write("                params.append(\"vtahun_laporan\", vtahun_laporan);\r\n");
      out.write("\r\n");
      out.write("                const response = await fetch(\r\n");
      out.write("                    getContextPath() + '/mon-pengerjaan-perprovupi',\r\n");
      out.write("                    {\r\n");
      out.write("                        method: \"POST\",\r\n");
      out.write("                        headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n");
      out.write("                        body: params\r\n");
      out.write("                    }\r\n");
      out.write("                );\r\n");
      out.write("\r\n");
      out.write("                if (!response.ok) {\r\n");
      out.write("                    throw new Error(\"HTTP Error \" + response.status);\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                const json = await response.json();\r\n");
      out.write("                const data = json.data || [];\r\n");
      out.write("\r\n");
      out.write("                if (data.length === 0) {\r\n");
      out.write("                    alert(\"Tidak ada data untuk diekspor.\");\r\n");
      out.write("                    return;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                data.forEach(function (item, idx) {\r\n");
      out.write("                    allData.push([\r\n");
      out.write("                        item.URUT != 5 ? (idx + 1) : \"\",\r\n");
      out.write("                        item.TAHUN || \"\",\r\n");
      out.write("                        item.KD_PROV || \"\",\r\n");
      out.write("                        item.PROVINSI || \"\",\r\n");
      out.write("                        item.JTR_RENCANA || \"\",\r\n");
      out.write("                        item.JTM_RENCANA || \"\",\r\n");
      out.write("                        item.GRD_RENCANA || \"\",\r\n");
      out.write("                        item.JTR_WO || \"\",\r\n");
      out.write("                        item.JTM_WO || \"\",\r\n");
      out.write("                        item.GRD_WO || \"\",\r\n");
      out.write("                        item.JTR_PROGRES || \"\",\r\n");
      out.write("                        item.JTM_PROGRES || \"\",\r\n");
      out.write("                        item.GRD_PROGRES || \"\",\r\n");
      out.write("                        item.JTR_FINAL   || \"\",\r\n");
      out.write("                        item.JTM_FINAL   || \"\",\r\n");
      out.write("                        item.GRD_FINAL   || \"\",\r\n");
      out.write("                        item.JTR_PROSEN  || \"\",\r\n");
      out.write("                        item.JTM_PROSEN  || \"\",\r\n");
      out.write("                        item.GRD_PROSEN  || \"\"\r\n");
      out.write("                    ]);\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                // ============================================================\r\n");
      out.write("                // 2. AOA (Array of Array)\r\n");
      out.write("                // ============================================================\r\n");
      out.write("                const timestamp = new Date().toLocaleString(\"id-ID\");\r\n");
      out.write("\r\n");
      out.write("                const rows = [\r\n");
      out.write("                    [\"LISA - REKAP PENGERJAAN PEKERJAAN\"],\r\n");
      out.write("                    [\"TAHUN\", \": \" + vtahun_laporan],\r\n");
      out.write("                    [\"TANGGAL DOWNLOAD\", \": \" + timestamp],\r\n");
      out.write("                    [],\r\n");
      out.write("                    headers\r\n");
      out.write("                ].concat(allData);\r\n");
      out.write("\r\n");
      out.write("                // ============================================================\r\n");
      out.write("                // 3. SHEETJS\r\n");
      out.write("                // ============================================================\r\n");
      out.write("                const ws = XLSX.utils.aoa_to_sheet(rows);\r\n");
      out.write("                const wb = XLSX.utils.book_new();\r\n");
      out.write("                XLSX.utils.book_append_sheet(wb, ws, \"REKAP\");\r\n");
      out.write("\r\n");
      out.write("                const wbout = XLSX.write(wb, {\r\n");
      out.write("                    bookType: \"xlsx\",\r\n");
      out.write("                    type: \"array\"\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                // ============================================================\r\n");
      out.write("                // 4. XLSXPOPULATE STYLING\r\n");
      out.write("                // ============================================================\r\n");
      out.write("                const filename =\r\n");
      out.write("                    'REKAP_PENGERJAAN_PEMASANGAN_PROV_' + vtahun_laporan + '.xlsx';\r\n");
      out.write("\r\n");
      out.write("                await XlsxPopulate.fromDataAsync(wbout)\r\n");
      out.write("                    .then(function (workbook) {\r\n");
      out.write("\r\n");
      out.write("                        const sheet = workbook.sheet(0);\r\n");
      out.write("                        const totalCols = headers.length;\r\n");
      out.write("                        const lastCol = String.fromCharCode(64 + totalCols);\r\n");
      out.write("                        const lastRow = rows.length;\r\n");
      out.write("\r\n");
      out.write("                        // Judul\r\n");
      out.write("                        sheet.range(\"A1:\" + lastCol + \"1\")\r\n");
      out.write("                            .merged(true)\r\n");
      out.write("                            .style({\r\n");
      out.write("                                bold: true,\r\n");
      out.write("                                horizontalAlignment: \"center\",\r\n");
      out.write("                                fontSize: 14\r\n");
      out.write("                            });\r\n");
      out.write("                        \r\n");
      out.write("                        // üëâ TAMBAHKAN DI SINI\r\n");
      out.write("                        sheet.range(\"A2:B2\").style({ bold: true }); // TAHUN\r\n");
      out.write("                        sheet.range(\"A3:B3\").style({ bold: true }); // TANGGAL DOWNLOAD\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("                        // Header\r\n");
      out.write("                        sheet.range(\"A5:\" + lastCol + \"5\")\r\n");
      out.write("                            .style({\r\n");
      out.write("                                bold: true,\r\n");
      out.write("                                fill: \"CCCCCC\",\r\n");
      out.write("                                border: true,\r\n");
      out.write("                                horizontalAlignment: \"center\",\r\n");
      out.write("                                verticalAlignment: \"center\"\r\n");
      out.write("                            });\r\n");
      out.write("\r\n");
      out.write("                        // Border data\r\n");
      out.write("                        sheet.range(\"A5:\" + lastCol + lastRow)\r\n");
      out.write("                            .style({ border: true });\r\n");
      out.write("\r\n");
      out.write("                        // Lebar kolom\r\n");
      out.write("                        for (var c = 1; c <= totalCols; c++) {\r\n");
      out.write("                            sheet.column(c).width(22);\r\n");
      out.write("                        }\r\n");
      out.write("\r\n");
      out.write("                        return workbook.outputAsync();\r\n");
      out.write("                    })\r\n");
      out.write("                    .then(function (blob) {\r\n");
      out.write("                        saveAs(blob, filename);\r\n");
      out.write("                    });\r\n");
      out.write("\r\n");
      out.write("            } catch (e) {\r\n");
      out.write("                console.error(e);\r\n");
      out.write("                alert(\"Terjadi error: \" + e.message);\r\n");
      out.write("            } finally {\r\n");
      out.write("                btn.prop('disabled', false).text(\"Export Excel Rekap\");\r\n");
      out.write("                $('#spinnerOverlay').hide();\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("    \r\n");
      out.write("        $('#btnExportMonRkpAllExcel2').on('click', async function () {\r\n");
      out.write("            exportRekapPengerjaanExcel($('#tahun_laporan').val());\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        // ---------------------------------------------------------------------------------------------\r\n");
      out.write("        // 1B-1) show Data Monitoring Detail/Detail PerUpi Modal Large \r\n");
      out.write("        // ---------------------------------------------------------------------------------------------\r\n");
      out.write("        let lastPageBeforeSearchDetail = 0;\r\n");
      out.write("        let detailTable = null;\r\n");
      out.write("\r\n");
      out.write("        $('#dataModal').on('shown.bs.modal', function () {\r\n");
      out.write("\r\n");
      out.write("            $('#dataModalLabel').text('Detail Data : ' + detailFilterParams.vnomor_kontrak_rinci);\r\n");
      out.write("\r\n");
      out.write("            // üî• Jika tabel sudah ada ‚Üí reload saja\r\n");
      out.write("            if (detailTable) {\r\n");
      out.write("                detailTable.ajax.reload(null, true);\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            // üî• Inisialisasi DataTable\r\n");
      out.write("            detailTable = $('#table_mondaf_provupi').DataTable({\r\n");
      out.write("                processing: true,\r\n");
      out.write("                serverSide: true,\r\n");
      out.write("                scrollX: true,\r\n");
      out.write("                ajax: {\r\n");
      out.write("                    url: getContextPath() + '/mon-pengerjaan-perkontrak',\r\n");
      out.write("                    type: 'POST',\r\n");
      out.write("                    data: function (d) {\r\n");
      out.write("                        d.act = 'detailData';\r\n");
      out.write("                        d.vtahun_laporan = detailFilterParams.vtahun_laporan;\r\n");
      out.write("                        d.vkdprov = detailFilterParams.vkdprov;\r\n");
      out.write("                        d.vkdkab  = detailFilterParams.vkdkab;\r\n");
      out.write("                        d.vkdkec  = detailFilterParams.vkdkec;\r\n");
      out.write("                        d.vkdkel  = detailFilterParams.vkdkel;\r\n");
      out.write("                        d.vnomor_kontrak_rinci  = detailFilterParams.vnomor_kontrak_rinci;\r\n");
      out.write("                        console.log('Kirim data ke server:', d);\r\n");
      out.write("                    },\r\n");
      out.write("                    dataSrc: function (json) {\r\n");
      out.write("                        console.log('Response dari server:', json);\r\n");
      out.write("                        return json.data || [];\r\n");
      out.write("                    }\r\n");
      out.write("                },\r\n");
      out.write("                columns: [\r\n");
      out.write("                    { data: null, orderable: false, className: 'text-center', render: (data, type, row, meta) => meta.row + meta.settings._iDisplayStart + 1 },\r\n");
      out.write("                    {data:'NOMOR_KONTRAK_RINCI'},\r\n");
      out.write("                    {data:'KATEGORI_PEMBANGUNAN'},\r\n");
      out.write("                    {data:'MATERIAL_GROUP'},\r\n");
      out.write("                    {data:'KODE_MATERIAL'},\r\n");
      out.write("                    {data:'PENGGUNAAN'},\r\n");
      out.write("                    {data:'NAMA_MATERIAL'},\r\n");
      out.write("                    {data:'VOLUME_RENCANA'},\r\n");
      out.write("                    {data:'VOLUME_TERPASANG'},\r\n");
      out.write("                    {data:'SATUAN'}\r\n");
      out.write("                ],\r\n");
      out.write("                lengthMenu: [[10, 100, 1000], [10, 100, 1000]]\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            // Simpan page sebelum search\r\n");
      out.write("            detailTable.on('page.dt', () => {\r\n");
      out.write("                if (!detailTable.search()) lastPageBeforeSearchDetail = detailTable.page();\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            // Force ke page 0 saat search\r\n");
      out.write("            detailTable.on('preXhr.dt', (e, settings, data) => {\r\n");
      out.write("                if (detailTable.search()) {\r\n");
      out.write("                    settings._iDisplayStart = 0;\r\n");
      out.write("                    data.start = 0;\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            // Kembali ke page sebelum search\r\n");
      out.write("            detailTable.on('search.dt', () => {\r\n");
      out.write("                if (!detailTable.search()) {\r\n");
      out.write("                    setTimeout(() => {\r\n");
      out.write("                        detailTable.page(lastPageBeforeSearchDetail).draw('page');\r\n");
      out.write("                    }, 300);\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("        });\r\n");
      out.write("       \r\n");
      out.write("        // ----------------------------------------------------------------------------\r\n");
      out.write("        // 1B-2) Export ke exel semua data MON Detail\r\n");
      out.write("        // ----------------------------------------------------------------------------\r\n");
      out.write("        // Fungsi format angka ribuan (lokal Indonesia)\r\n");
      out.write("        const formatRibuan = (angka) => new Intl.NumberFormat('id-ID').format(angka);\r\n");
      out.write("\r\n");
      out.write("        // Ambil nama UID/UIW PLN  dari DB\r\n");
      out.write("        async function fetchNamaUnitUPI(kd_dist) {\r\n");
      out.write("            const params = new URLSearchParams();\r\n");
      out.write("            params.append('act', 'getNamaUnitUPI');\r\n");
      out.write("            params.append('kd_dist', kd_dist);\r\n");
      out.write("\r\n");
      out.write("            const response = await fetch(getContextPath() + '/mon-pengerjaan-perprovupi', {\r\n");
      out.write("                method: 'POST',\r\n");
      out.write("                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n");
      out.write("                body: params.toString()\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            if (!response.ok) throw new Error(\"Gagal mengambil data UNITUPI\");\r\n");
      out.write("\r\n");
      out.write("            const json = await response.json();\r\n");
      out.write("            if (json.status !== 'success') throw new Error(\"Data UNITUPI tidak ditemukan\");\r\n");
      out.write("\r\n");
      out.write("            return json.data.NAMA_DIST || '';\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        /* =========================================================\r\n");
      out.write("        * HELPER\r\n");
      out.write("        * ========================================================= */\r\n");
      out.write("        function safeName(str) {\r\n");
      out.write("            return String(str || '')\r\n");
      out.write("                .replace(/[\\\\\\/:*?\"<>|]/g, '')\r\n");
      out.write("                .replace(/\\s+/g, '_')\r\n");
      out.write("                .toUpperCase();\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        function styleRow(row, fromCol, toCol, opt = {}) {\r\n");
      out.write("            for (let c = fromCol; c <= toCol; c++) {\r\n");
      out.write("                const cell = row.getCell(c);\r\n");
      out.write("\r\n");
      out.write("                cell.border = {\r\n");
      out.write("                    top: { style: 'thin' },\r\n");
      out.write("                    left: { style: 'thin' },\r\n");
      out.write("                    bottom: { style: 'thin' },\r\n");
      out.write("                    right: { style: 'thin' }\r\n");
      out.write("                };\r\n");
      out.write("\r\n");
      out.write("                if (opt.bold) {\r\n");
      out.write("                    cell.font = Object.assign({}, cell.font, { bold: true });\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                if (opt.fill) {\r\n");
      out.write("                    cell.fill = {\r\n");
      out.write("                        type: 'pattern',\r\n");
      out.write("                        pattern: 'solid',\r\n");
      out.write("                        fgColor: { argb: opt.fill }\r\n");
      out.write("                    };\r\n");
      out.write("                }\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        /* =========================================================\r\n");
      out.write("        * EXPORT EXCEL\r\n");
      out.write("        * ========================================================= */\r\n");
      out.write("        $('#btnExportMonDftAllExcelOneSheet').on('click', async function () {\r\n");
      out.write("\r\n");
      out.write("            const btn = $(this);\r\n");
      out.write("            $('#spinnerOverlay').show();\r\n");
      out.write("            btn.prop('disabled', true).text('Memuat...');\r\n");
      out.write("\r\n");
      out.write("            try {\r\n");
      out.write("\r\n");
      out.write("                /* ================= PARAM ================= */\r\n");
      out.write("                const {\r\n");
      out.write("                    vtahun_laporan\r\n");
      out.write("                } = detailFilterParams;\r\n");
      out.write("\r\n");
      out.write("                if (!vtahun_laporan) {\r\n");
      out.write("                    alert('Filter belum lengkap');\r\n");
      out.write("                    return;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                /* ================= AMBIL DATA ================= */\r\n");
      out.write("                const pageSize = 1000;\r\n");
      out.write("                let start = 0;\r\n");
      out.write("                let draw = 1;\r\n");
      out.write("                let dataAll = [];\r\n");
      out.write("\r\n");
      out.write("                while (true) {\r\n");
      out.write("                    const params = new URLSearchParams({\r\n");
      out.write("                        act: 'detailData',\r\n");
      out.write("                        vtahun_laporan,\r\n");
      out.write("                        vnomor_kontrak_rinci,\r\n");
      out.write("                        start,\r\n");
      out.write("                        length: pageSize,\r\n");
      out.write("                        draw: draw++\r\n");
      out.write("                    });\r\n");
      out.write("\r\n");
      out.write("                    const res = await fetch(getContextPath() + '/mon-pengerjaan-perprovupi', {\r\n");
      out.write("                        method: 'POST',\r\n");
      out.write("                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n");
      out.write("                        body: params.toString()\r\n");
      out.write("                    });\r\n");
      out.write("\r\n");
      out.write("                    const json = await res.json();\r\n");
      out.write("                    if (!json.data || !json.data.length) break;\r\n");
      out.write("\r\n");
      out.write("                    dataAll.push(...json.data);\r\n");
      out.write("                    if (json.data.length < pageSize) break;\r\n");
      out.write("                    start += pageSize;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                if (!dataAll.length) {\r\n");
      out.write("                    alert('Data kosong');\r\n");
      out.write("                    return;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                /* ================= SORT DATA ================= */\r\n");
      out.write("                const groupOrder = ['TIANG', 'KABEL', 'AKSESORIS'];\r\n");
      out.write("\r\n");
      out.write("                dataAll.sort((a, b) => {\r\n");
      out.write("                    const ga = a.MATERIAL_GROUP || '';\r\n");
      out.write("                    const gb = b.MATERIAL_GROUP || '';\r\n");
      out.write("\r\n");
      out.write("                    const indexA = groupOrder.indexOf(ga) !== -1 ? groupOrder.indexOf(ga) : groupOrder.length;\r\n");
      out.write("                    const indexB = groupOrder.indexOf(gb) !== -1 ? groupOrder.indexOf(gb) : groupOrder.length;\r\n");
      out.write("\r\n");
      out.write("                    if (indexA !== indexB) return indexA - indexB;\r\n");
      out.write("\r\n");
      out.write("                    return (a.NOMOR_KONTRAK_RINCI || '').localeCompare(b.NOMOR_KONTRAK_RINCI || '') ||\r\n");
      out.write("                        (a.NAMA_MATERIAL || '').localeCompare(b.NAMA_MATERIAL || '');\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                /* ================= WORKBOOK ================= */\r\n");
      out.write("                const workbook = new ExcelJS.Workbook();\r\n");
      out.write("                workbook.creator = 'Monitoring PLN';\r\n");
      out.write("                workbook.created = new Date();\r\n");
      out.write("\r\n");
      out.write("                const ws = workbook.addWorksheet('DETAIL', { properties: { outlineLevelRow: true } });\r\n");
      out.write("\r\n");
      out.write("                ws.views = [{\r\n");
      out.write("                    showOutlineSymbols: true,\r\n");
      out.write("                    state: 'frozen',\r\n");
      out.write("                    ySplit: 7\r\n");
      out.write("                }];\r\n");
      out.write("\r\n");
      out.write("                /* ================= STYLE HELPER ================= */\r\n");
      out.write("                function styleRow(row, startCol, endCol, opt = {}) {\r\n");
      out.write("                    for (let c = startCol; c <= endCol; c++) {\r\n");
      out.write("                        const cell = row.getCell(c);\r\n");
      out.write("                        cell.border = {\r\n");
      out.write("                            top: { style: 'thin' },\r\n");
      out.write("                            left: { style: 'thin' },\r\n");
      out.write("                            bottom: { style: 'thin' },\r\n");
      out.write("                            right: { style: 'thin' }\r\n");
      out.write("                        };\r\n");
      out.write("                        if (opt.bold) cell.font = { bold: true };\r\n");
      out.write("                        if (opt.fill) {\r\n");
      out.write("                            cell.fill = {\r\n");
      out.write("                                type: 'pattern',\r\n");
      out.write("                                pattern: 'solid',\r\n");
      out.write("                                fgColor: { argb: opt.fill }\r\n");
      out.write("                            };\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                /* ================= HEADER ATAS ================= */\r\n");
      out.write("                const title = ws.addRow(['REKAP DETAIL PENGERJAAN']);\r\n");
      out.write("                ws.mergeCells(title.number, 1, title.number, 29);\r\n");
      out.write("                styleRow(title, 1, 29, { bold: true });\r\n");
      out.write("\r\n");
      out.write("                ws.addRows([\r\n");
      out.write("                    ['TAHUN', vtahun_laporan],\r\n");
      out.write("                    ['KETERANGAN', vnomor_kontrak_rinci],\r\n");
      out.write("                    ['TANGGAL DOWNLOAD', new Date().toLocaleString('id-ID')],\r\n");
      out.write("                    []\r\n");
      out.write("                ]);\r\n");
      out.write("\r\n");
      out.write("                /* ================= HEADER TABEL ================= */\r\n");
      out.write("                const header = ws.addRow([\r\n");
      out.write("                    'NO','INFOLABEL','KATEGORI','TRANSMISI',\r\n");
      out.write("                    'MATERIAL_GROUP_ID','MATERIAL_GROUP','KODE_MATERIAL','NAMA_MATERIAL',\r\n");
      out.write("                    'JUMLAH_MDU','SATUAN','TAHUN','KD_PROV','PROVINSI',\r\n");
      out.write("                    'KD_KAB','KABUPATEN','KD_KEC','KECAMATAN',\r\n");
      out.write("                    'KD_KEL','DESA','UNITUPI','NAMA_UNITUPI',\r\n");
      out.write("                    'UNITAP','NAMA_UNITAP','UNITUP','NAMA_UNITUP',\r\n");
      out.write("                    'ID_PERENCANAAN','NOMOR_KONTRAK','NOMOR_KONTRAK_RINCI','KODE_PEMBANGUNAN'\r\n");
      out.write("                ]);\r\n");
      out.write("                styleRow(header, 1, 29, { bold: true, fill: 'E0E0E0' });\r\n");
      out.write("\r\n");
      out.write("                /* ================= DATA LOOP ================= */\r\n");
      out.write("                let no = 1;\r\n");
      out.write("                let lastKontrak = null;\r\n");
      out.write("                let lastGroup = null;\r\n");
      out.write("                let subtotalGroup = 0;\r\n");
      out.write("\r\n");
      out.write("                for (const d of dataAll) {\r\n");
      out.write("                    const kontrak = d.NOMOR_KONTRAK_RINCI || '';\r\n");
      out.write("                    const group = d.MATERIAL_GROUP || '';\r\n");
      out.write("                    const qty = Number(d.JUMLAH_MDU) || 0;\r\n");
      out.write("\r\n");
      out.write("                    /* === GANTI KONTRAK === */\r\n");
      out.write("                    if (lastKontrak && kontrak !== lastKontrak) {\r\n");
      out.write("                        /* SUBTOTAL GROUP SEBELUM KONTRAK BERUBAH */\r\n");
      out.write("                        if (lastGroup) {\r\n");
      out.write("                            const rSub = ws.addRow([\r\n");
      out.write("                                'SUBTOTAL ' + lastGroup, '', '', '', '', '', '', '', subtotalGroup\r\n");
      out.write("                            ]);\r\n");
      out.write("                            for (let c = 2; c <= 29; c++) if (c !== 9) rSub.getCell(c).value = '';\r\n");
      out.write("                            styleRow(rSub, 1, 29, { bold: true, fill: 'FFF7CC' });\r\n");
      out.write("                            subtotalGroup = 0;\r\n");
      out.write("                        }\r\n");
      out.write("\r\n");
      out.write("                        /* END KONTRAK */\r\n");
      out.write("                        const rEnd = ws.addRow(['END KONTRAK RINCI : ' + lastKontrak]);\r\n");
      out.write("                        ws.mergeCells(rEnd.number, 1, rEnd.number, 29);\r\n");
      out.write("                        styleRow(rEnd, 1, 29, { bold: true, fill: 'FFE0B2' });\r\n");
      out.write("                        rEnd.outlineLevel = 0;\r\n");
      out.write("\r\n");
      out.write("                        lastGroup = null;\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("                    /* START KONTRAK */\r\n");
      out.write("                    if (kontrak !== lastKontrak) {\r\n");
      out.write("                        const rStart = ws.addRow(['START KONTRAK RINCI : ' + kontrak]);\r\n");
      out.write("                        ws.mergeCells(rStart.number, 1, rStart.number, 29);\r\n");
      out.write("                        styleRow(rStart, 1, 29, { bold: true, fill: 'E3F2FD' });\r\n");
      out.write("                        rStart.outlineLevel = 0;\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("                    /* GANTI GROUP */\r\n");
      out.write("                    if (lastGroup && group !== lastGroup) {\r\n");
      out.write("                        const rSub = ws.addRow([\r\n");
      out.write("                            'SUBTOTAL ' + lastGroup, '', '', '', '', '', '', '', subtotalGroup\r\n");
      out.write("                        ]);\r\n");
      out.write("                        for (let c = 2; c <= 29; c++) if (c !== 9) rSub.getCell(c).value = '';\r\n");
      out.write("                        styleRow(rSub, 1, 29, { bold: true, fill: 'FFF7CC' });\r\n");
      out.write("                        subtotalGroup = 0;\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("                    /* DETAIL ROW */\r\n");
      out.write("                    const r = ws.addRow([\r\n");
      out.write("                        no++, d.INFOLABEL, d.KATEGORI_PEMBANGUNAN, d.TRANSMISI,\r\n");
      out.write("                        d.MATERIAL_GROUP_ID, d.MATERIAL_GROUP, d.KODE_MATERIAL, d.NAMA_MATERIAL,\r\n");
      out.write("                        qty, d.SATUAN, d.TAHUN, d.KD_PROV, d.PROVINSI,\r\n");
      out.write("                        d.KD_KAB, d.KABUPATENKOTA, d.KD_KEC, d.KECAMATAN,\r\n");
      out.write("                        d.KD_KEL, d.DESAKELURAHAN, d.UNITUPI, d.NAMA_UNITUPI,\r\n");
      out.write("                        d.UNITAP, d.NAMA_UNITAP, d.UNITUP, d.NAMA_UNITUP,\r\n");
      out.write("                        d.ID_PERENCANAAN, d.NOMOR_KONTRAK, d.NOMOR_KONTRAK_RINCI, d.KODE_PEMBANGUNAN\r\n");
      out.write("                    ]);\r\n");
      out.write("                    styleRow(r, 1, 29);\r\n");
      out.write("                    r.outlineLevel = 1;\r\n");
      out.write("                    r.hidden = true;\r\n");
      out.write("\r\n");
      out.write("                    subtotalGroup += qty;\r\n");
      out.write("                    lastGroup = group;\r\n");
      out.write("                    lastKontrak = kontrak;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                /* SUBTOTAL TERAKHIR */\r\n");
      out.write("                if (lastGroup) {\r\n");
      out.write("                    const rSub = ws.addRow([\r\n");
      out.write("                        'SUBTOTAL ' + lastGroup, '', '', '', '', '', '', '', subtotalGroup\r\n");
      out.write("                    ]);\r\n");
      out.write("                    for (let c = 2; c <= 29; c++) if (c !== 9) rSub.getCell(c).value = '';\r\n");
      out.write("                    styleRow(rSub, 1, 29, { bold: true, fill: 'FFF7CC' });\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                /* END KONTRAK TERAKHIR */\r\n");
      out.write("                if (lastKontrak) {\r\n");
      out.write("                    const rEnd = ws.addRow(['END KONTRAK RINCI : ' + lastKontrak]);\r\n");
      out.write("                    ws.mergeCells(rEnd.number, 1, rEnd.number, 29);\r\n");
      out.write("                    styleRow(rEnd, 1, 29, { bold: true, fill: 'FFE0B2' });\r\n");
      out.write("                    rEnd.outlineLevel = 0;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                /* ================= SAVE ================= */\r\n");
      out.write("                const buffer = await workbook.xlsx.writeBuffer();\r\n");
      out.write("                saveAs(\r\n");
      out.write("                    new Blob([buffer]),\r\n");
      out.write("                    'DETAIL_' + vtahun_laporan + '_' + vnomor_kontrak_rinci + '.xlsx'\r\n");
      out.write("                );\r\n");
      out.write("\r\n");
      out.write("            } catch (e) {\r\n");
      out.write("                console.error(e);\r\n");
      out.write("                alert('Gagal export: ' + e.message);\r\n");
      out.write("            } finally {\r\n");
      out.write("                btn.prop('disabled', false).text('Export Excel');\r\n");
      out.write("                $('#spinnerOverlay').hide();\r\n");
      out.write("            }\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("    });\r\n");
      out.write("</script>\r\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
