/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.47
 * Generated at: 2026-01-05 07:13:35 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.views.monitoring;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;

public final class v1a_005fmon_005fperprovupi_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("\r\n");
      out.write("<style>\r\n");
      out.write("   /* CSS TABLE REKAP - SAMAKAN DENGAN TABEL Detail */\r\n");
      out.write("    #tablemon_upi {\r\n");
      out.write("        table-layout: auto; /* Sama seperti #dataModal table */\r\n");
      out.write("        font-size: 0.75rem; /* Sama dengan modal-body */\r\n");
      out.write("        width: 100%;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    #tablemon_upi th,\r\n");
      out.write("    #tablemon_upi td {\r\n");
      out.write("        font-size: 0.7rem;      /* Sama seperti table detail */\r\n");
      out.write("        padding: 4px 6px;       /* Sama seperti table detail */\r\n");
      out.write("        white-space: nowrap;    /* Hindari wrap */\r\n");
      out.write("        overflow: hidden;\r\n");
      out.write("        text-overflow: ellipsis;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    #tablemon_upi th.sorting::after,\r\n");
      out.write("    #tablemon_upi th.sorting_asc::after,\r\n");
      out.write("    #tablemon_upi th.sorting_desc::after {\r\n");
      out.write("        display: none !important;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* Target wrapper DataTables untuk memastikan lebar 100% tidak terlampaui */\r\n");
      out.write("    #tablemon_upi_wrapper {\r\n");
      out.write("        width: 100%;\r\n");
      out.write("        max-width: 100%;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* Tambahan jika mau batas tinggi + scroll seperti modal */\r\n");
      out.write("    #tablemon_upi_wrapper .dataTables_scrollBody {\r\n");
      out.write("        max-height: 65vh;       /* Sesuaikan tinggi maksimal seperti modal */\r\n");
      out.write("        overflow-y: auto;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* CSS MODAL SHOW TABLE MONITORING Detail */\r\n");
      out.write("    #dataModal .modal-body {\r\n");
      out.write("        font-size: 0.75rem; /* Ukuran teks diperkecil */\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    #dataModal table th,\r\n");
      out.write("    #dataModal table td {\r\n");
      out.write("        font-size: 0.7rem;   /* Ukuran teks header dan isi tabel */\r\n");
      out.write("        padding: 4px 6px;    /* Padding dikurangi agar tidak terlalu lebar */\r\n");
      out.write("        white-space: nowrap; /* Hindari pemisahan baris */\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    #dataModal table {\r\n");
      out.write("        table-layout: auto; /* Gunakan auto agar kolom menyesuaikan konten */\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    #dataModal .datatable-container {\r\n");
      out.write("        max-height: 65vh;    /* Batasi tinggi agar bisa scroll */\r\n");
      out.write("        overflow-y: auto;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* Pastikan form-container relatif */\r\n");
      out.write("    .form-monitoring {\r\n");
      out.write("        position: relative;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    .datatable-container {\r\n");
      out.write("        overflow-x: auto;\r\n");
      out.write("        width: 100%;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* Buat spinner tetap di tengah form tapi transparan */\r\n");
      out.write("    .loading-overlay {\r\n");
      out.write("        position: absolute;\r\n");
      out.write("        top: 50%;\r\n");
      out.write("        left: 50%;\r\n");
      out.write("        transform: translate(-50%, -50%);\r\n");
      out.write("        z-index: 1050;\r\n");
      out.write("        text-align: center;\r\n");
      out.write("        font-size: 0.95rem;\r\n");
      out.write("        /* Tidak ada background, padding, atau box */\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* tambah lebar large modal */\r\n");
      out.write("    .modal-xxl {\r\n");
      out.write("        max-width: 98% !important; /* Atur sesuai kebutuhan */\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* legenda tulisan hedar dan kotak  */\r\n");
      out.write("    .form-box {\r\n");
      out.write("        border: 1px solid #ddd;\r\n");
      out.write("        border-radius: 4px;\r\n");
      out.write("        padding: 20px;\r\n");
      out.write("        margin: 20px 0;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    .form-box legend {\r\n");
      out.write("        font-weight: bold;\r\n");
      out.write("        font-size: 1rem;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    .form-box fieldset {\r\n");
      out.write("        border: none;\r\n");
      out.write("        padding: 0;\r\n");
      out.write("        margin: 0;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    #tahun_laporan {\r\n");
      out.write("        text-transform: uppercase;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* ----------\r\n");
      out.write("       Spiner css\r\n");
      out.write("       ----------\r\n");
      out.write("    */\r\n");
      out.write("    #loadingSpinner {\r\n");
      out.write("        display: none;\r\n");
      out.write("        position: fixed;\r\n");
      out.write("        top: 20%;\r\n");
      out.write("        left: 50%;\r\n");
      out.write("        transform: translate(-50%, 0);\r\n");
      out.write("        z-index: 9999;\r\n");
      out.write("        /* background-color: rgba(255, 255, 255, 0.7); */\r\n");
      out.write("        padding: 20px 30px;\r\n");
      out.write("        border-radius: 6px;\r\n");
      out.write("        /* box-shadow: 0 0 10px rgba(0,0,0,0.2); */\r\n");
      out.write("        text-align: center;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("    #loadingSpinner .spinner-content {\r\n");
      out.write("        text-align: center;\r\n");
      out.write("        font-size: 1.2rem;\r\n");
      out.write("        color: #333;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    .overlay-spinner {\r\n");
      out.write("        position: absolute;\r\n");
      out.write("        top: 40%;\r\n");
      out.write("        left: 45%;\r\n");
      out.write("        z-index: 1060;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* Semua header */\r\n");
      out.write("    #tablemon_upi thead th {\r\n");
      out.write("        text-align: center;\r\n");
      out.write("        vertical-align: middle;\r\n");
      out.write("        font-weight: 600;\r\n");
      out.write("        color: #ffffff;            /* teks putih */\r\n");
      out.write("        border-color: #7d7c7a;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* Warna dasar kuning */\r\n");
      out.write("    #tablemon_upi thead.hdr-yellow th {\r\n");
      out.write("        background-color: #6390cb;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* Optional: hover sorting DataTables tetap kontras */\r\n");
      out.write("    #tablemon_upi thead th.sorting,\r\n");
      out.write("    #tablemon_upi thead th.sorting_asc,\r\n");
      out.write("    #tablemon_upi thead th.sorting_desc {\r\n");
      out.write("        color: #ffffff !important;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* ===== SUBTOTAL ROW ===== */\r\n");
      out.write("    table.dataTable tbody tr.subtotal-row td {\r\n");
      out.write("        background-color: #fff7e6 !important;\r\n");
      out.write("        font-weight: 700;\r\n");
      out.write("        border-top: 2px solid #f0ad4e !important;\r\n");
      out.write("        border-bottom: 2px solid #f0ad4e !important;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* jaga garis vertikal */\r\n");
      out.write("    table.dataTable tbody tr.subtotal-row td:not(:last-child) {\r\n");
      out.write("        border-right: 1px solid #dee2e6 !important;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* ðŸ‘‰ indent tulisan TOTAL (Â± 5 spasi) */\r\n");
      out.write("    table.dataTable tbody tr.subtotal-row td:first-child {\r\n");
      out.write("        padding-left: 40px !important; /* â‰ˆ 5 spasi */\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* CSS khusus untuk kolom subtotal angka */\r\n");
      out.write("    .subtotal-row td.stynumeric {\r\n");
      out.write("        text-align: right;\r\n");
      out.write("        padding-right: 8px; /* optional, supaya rapi */\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* ðŸ”µ garis penutup per NOMOR_KONTRAK_RINCI */\r\n");
      out.write("    /* ðŸ”µ START KONTRAK RINCI */\r\n");
      out.write("    tr.start-kontrak-row td {\r\n");
      out.write("        border-top: 2px dashed #43a047;\r\n");
      out.write("        padding: 10px 0;\r\n");
      out.write("        background: #f1f8e9;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    .start-kontrak-text {\r\n");
      out.write("        text-align: left;\r\n");
      out.write("        font-weight: bold;\r\n");
      out.write("        color: #2e7d32;\r\n");
      out.write("        letter-spacing: 1px;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    /* ðŸ”´ END KONTRAK RINCI (SATU GARIS PENUTUP SAJA) */\r\n");
      out.write("    tr.end-kontrak-row td {\r\n");
      out.write("        border-top: 2px dashed #e53935;   /* merah */\r\n");
      out.write("        padding: 10px 0;\r\n");
      out.write("        background: #fdecea;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    .end-kontrak-text {\r\n");
      out.write("        text-align: left;\r\n");
      out.write("        font-weight: bold;\r\n");
      out.write("        color: #b71c1c;\r\n");
      out.write("        letter-spacing: 1px;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("</style>\r\n");
      out.write("\r\n");
      out.write("<!-- âœ… Spinner Global untuk semua loading -->\r\n");
      out.write("<div id=\"spinnerOverlay\" style=\"display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:9999;\">\r\n");
      out.write("    <div class=\"spinner-border text-primary\" role=\"status\"></div>\r\n");
      out.write("</div>\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("<!-- Modal Large -->\r\n");
      out.write("<div class=\"modal fade\" id=\"dataModal\" tabindex=\"-1\" aria-labelledby=\"dataModalLabel\" aria-hidden=\"true\">\r\n");
      out.write("  <!-- <div class=\"modal-dialog modal-dialog-scrollable modal-xl\"> -->\r\n");
      out.write("  <div class=\"modal-dialog modal-dialog-scrollable modal-xl modal-xxl\">\r\n");
      out.write("    <div class=\"modal-content\">\r\n");
      out.write("        <div class=\"modal-header\">\r\n");
      out.write("            <h5 class=\"modal-title\" id=\"dataModalLabel\">Detail Data</h5>\r\n");
      out.write("            <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Tutup\"></button>\r\n");
      out.write("        </div>\r\n");
      out.write("        <div class=\"modal-body\" id=\"modalBody\">\r\n");
      out.write("            <!-- Tombol Export -->\r\n");
      out.write("            <div class=\"mb-2\">\r\n");
      out.write("                <button id=\"btnExportMonDftAllExcelOneSheet\" class=\"btn btn-success btn-export\">\r\n");
      out.write("                    <i class=\"fa fa-file-excel-o\"></i> Export Detail Per-UPI\r\n");
      out.write("                </button>\r\n");
      out.write("            </div>\r\n");
      out.write("        <div class=\"datatable-container\" style=\"overflow-x: auto;\">\r\n");
      out.write("        <table id=\"table_mondaf_provupi\" class=\"table table-bordered table-striped w-100\" width=\"100%\">\r\n");
      out.write("                <thead>\r\n");
      out.write("                <tr>\r\n");
      out.write("                    <th>NO</th>\r\n");
      out.write("                    <th>INFOLABEL</th>\r\n");
      out.write("                    <th>NOMOR_KONTRAK_RINCI</th>\r\n");
      out.write("                    <th>KATEGORI_PEMBANGUNA</th>\r\n");
      out.write("                    <th>TRANSMISI</th>\r\n");
      out.write("                    <th>MATERIAL_GROUP</th>\r\n");
      out.write("                    <th>KODE_MATERIAL</th>\r\n");
      out.write("                    <th>NAMA_MATERIAL</th>\r\n");
      out.write("                    <th>JUMLAH_MDU</th>\r\n");
      out.write("                    <th>SATUAN</th>\r\n");
      out.write("                    <th>ID_TIANG</th>\r\n");
      out.write("                    <th>STATUS</th>\r\n");
      out.write("                    <th>TAHUN</th>\r\n");
      out.write("                    <th>KD_PROV</th>\r\n");
      out.write("                    <th>PROVINSI</th>\r\n");
      out.write("                    <th>KD_KAB</th>\r\n");
      out.write("                    <th>KABUPATENKOTA</th>\r\n");
      out.write("                    <th>KD_KEC</th>\r\n");
      out.write("                    <th>KECAMATAN</th>\r\n");
      out.write("                    <th>KD_KEL</th>\r\n");
      out.write("                    <th>DESAKELURAHAN</th>\r\n");
      out.write("                    <th>UNITUPI</th>\r\n");
      out.write("                    <th>UNITAP</th>\r\n");
      out.write("                    <th>UNITUP</th>\r\n");
      out.write("                    <th>ID_PERENCANAAN</th>\r\n");
      out.write("                    <th>NOMOR_KONTRAK</th>\r\n");
      out.write("                    <th>KODE_PEMBANGUNAN</th>\r\n");
      out.write("                    <th>MATERIAL_GROUP_ID</th>\r\n");
      out.write("                    <th>ROW_ITEMS</th>\r\n");
      out.write("                    <th>TOTAL_ITEMS</th>\r\n");
      out.write("                </tr>\r\n");
      out.write("                </thead>\r\n");
      out.write("            <tbody>\r\n");
      out.write("            </tbody>\r\n");
      out.write("          </table>\r\n");
      out.write("        </div>          \r\n");
      out.write("      </div>\r\n");
      out.write("      <div class=\"modal-footer\">\r\n");
      out.write("        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Tutup</button>\r\n");
      out.write("      </div>\r\n");
      out.write("    </div>\r\n");
      out.write("  </div>\r\n");
      out.write("</div>\r\n");
      out.write("\r\n");
      out.write("<fieldset style=\"border: 1px solid #ccc; border-radius: 4px; padding: 1.25rem;\">\r\n");
      out.write("    <legend style=\"font-size: 0.95rem; font-weight: bold; padding: 0 0.75rem; width: auto;\">\r\n");
      out.write("        Monitoring - Pengerjaan Progress Bangsang LISA\r\n");
      out.write("    </legend>\r\n");
      out.write("\r\n");
      out.write("    <div class=\"container mt-1\">\r\n");
      out.write("        <div class=\"form-monitoring\">\r\n");
      out.write("            <form id=\"form-monitoring\">\r\n");
      out.write("                <div class=\"row align-items-end g-3 mb-2\">\r\n");
      out.write("                    <!-- Input Bulan Laporan -->\r\n");
      out.write("                    <div class=\"col-md-4 col-lg-3\">\r\n");
      out.write("                        <label for=\"tahun_laporan\" class=\"form-label\">Tahun Laporan :</label>\r\n");
      out.write("                        <select id=\"tahun_laporan\" class=\"form-control\"></select>\r\n");
      out.write("                    </div>\r\n");
      out.write("                    <div class=\"col-md-4 col-lg-4\">\r\n");
      out.write("                        <label for=\"jenis_laporan\" class=\"form-label\">Jenis Laporan :</label>\r\n");
      out.write("                        <select id=\"jenis_laporan\" class=\"form-control\"> \r\n");
      out.write("                            <option value=\"provinsi\">PROVINSI</option>\r\n");
      out.write("                            <option value=\"upi\">UPI</option>\r\n");
      out.write("                        </select>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("                <div class=\"row align-items-end g-3 mb-2\"></div>\r\n");
      out.write("                <!-- Tombol Tampilkan -->\r\n");
      out.write("                    <div class=\"col-md-2\">\r\n");
      out.write("                        <label class=\"form-label d-none d-md-block\">&nbsp;</label> <!-- Spacer agar sejajar -->\r\n");
      out.write("                        <button id=\"btnTampil\" type=\"button\" class=\"btn btn-primary w-100\">\r\n");
      out.write("                            <i class=\"bi bi-search\"></i> Tampilkan\r\n");
      out.write("                        </button>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("            </form>\r\n");
      out.write("        </div>\r\n");
      out.write("\r\n");
      out.write("        <div class=\"mt-4\">\r\n");
      out.write("           <!-- Tombol export buatan sendiri -->\r\n");
      out.write("            <div class=\"mb-2\">\r\n");
      out.write("                <button id=\"btnExportMonRkpAllExcel\" class=\"btn btn-success btn-export\" style=\"display: none;\">\r\n");
      out.write("                    <i class=\"fa fa-file-excel-o\"></i> Download Excel\r\n");
      out.write("                </button>\r\n");
      out.write("                <button id=\"btnExportMonRkpAllExcel2\" class=\"btn btn-success btn-export\" >\r\n");
      out.write("                    <i class=\"fa fa-file-excel-o\"></i> Download Excel Rekap\r\n");
      out.write("                </button>\r\n");
      out.write("            </div>\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("            <div class=\"datatable-container\">\r\n");
      out.write("                <div class=\"datatable-scroll-wrapper\" style=\"overflow-x: auto;\">\r\n");
      out.write("                    <table id=\"tablemon_upi\" class=\"datatable-main table table-bordered table-striped\">\r\n");
      out.write("                        <!-- <thead>\r\n");
      out.write("                            <tr>\r\n");
      out.write("                                <th>NO</th>\r\n");
      out.write("                                <th>TAHUN</th>\r\n");
      out.write("                                <th>KD_PROV</th>\r\n");
      out.write("                                <th>PROVINSI</th>\r\n");
      out.write("                                <th>JTR_RENCANA</th>\r\n");
      out.write("                                <th>JTM_RENCANA</th>\r\n");
      out.write("                                <th>GRD_RENCANA</th>\r\n");
      out.write("                                <th>JTR_WO</th>\r\n");
      out.write("                                <th>JTM_WO</th>\r\n");
      out.write("                                <th>GRD_WO</th>\r\n");
      out.write("                            </tr>\r\n");
      out.write("                        </thead> -->\r\n");
      out.write("                        <thead class=\"hdr-yellow\">\r\n");
      out.write("                            <tr>\r\n");
      out.write("                                <th rowspan=\"2\" class=\"hdr-main\">NO</th>\r\n");
      out.write("                                <th rowspan=\"2\" class=\"hdr-main\">TAHUN</th>\r\n");
      out.write("                                <th rowspan=\"2\" class=\"hdr-main\">KD_PROV</th>\r\n");
      out.write("                                <th rowspan=\"2\" class=\"hdr-main\">PROVINSI</th>\r\n");
      out.write("\r\n");
      out.write("                                <th colspan=\"3\" class=\"hdr-rencana\">RENCANA</th>\r\n");
      out.write("                                <th colspan=\"3\" class=\"hdr-wo\">WORK ORDER</th>\r\n");
      out.write("                                <th colspan=\"3\" class=\"hdr-wo\">PROSES BANGSANG</th>\r\n");
      out.write("                                <th colspan=\"3\" class=\"hdr-wo\">KOREKSI BANGSANG</th>\r\n");
      out.write("                                <th colspan=\"3\" class=\"hdr-wo\">TERPASANG BANGSANG</th>\r\n");
      out.write("                                <th colspan=\"3\" class=\"hdr-wo\">PORSENTASE (%)</th>\r\n");
      out.write("                            </tr>\r\n");
      out.write("                            <tr>\r\n");
      out.write("                                <th class=\"hdr-rencana-sub\">JTR</th>\r\n");
      out.write("                                <th class=\"hdr-rencana-sub\">JTM</th>\r\n");
      out.write("                                <th class=\"hdr-rencana-sub\">GRD</th>\r\n");
      out.write("\r\n");
      out.write("                                <th class=\"hdr-wo-sub\">JTR</th>\r\n");
      out.write("                                <th class=\"hdr-wo-sub\">JTM</th>\r\n");
      out.write("                                <th class=\"hdr-wo-sub\">GRD</th>\r\n");
      out.write("\r\n");
      out.write("                                <th class=\"hdr-wo-sub\">JTR</th>\r\n");
      out.write("                                <th class=\"hdr-wo-sub\">JTM</th>\r\n");
      out.write("                                <th class=\"hdr-wo-sub\">GRD</th>\r\n");
      out.write("\r\n");
      out.write("                                <th class=\"hdr-wo-sub\">JTR</th>\r\n");
      out.write("                                <th class=\"hdr-wo-sub\">JTM</th>\r\n");
      out.write("                                <th class=\"hdr-wo-sub\">GRD</th>\r\n");
      out.write("\r\n");
      out.write("                                <th class=\"hdr-wo-sub\">JTR</th>\r\n");
      out.write("                                <th class=\"hdr-wo-sub\">JTM</th>\r\n");
      out.write("                                <th class=\"hdr-wo-sub\">GRD</th>\r\n");
      out.write("\r\n");
      out.write("                                <th class=\"hdr-wo-sub\">JTR</th>\r\n");
      out.write("                                <th class=\"hdr-wo-sub\">JTM</th>\r\n");
      out.write("                                <th class=\"hdr-wo-sub\">GRD</th>\r\n");
      out.write("                            </tr>\r\n");
      out.write("                        </thead>\r\n");
      out.write("                        <tbody></tbody>\r\n");
      out.write("                    </table>\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("    </div>\r\n");
      out.write("</fieldset>\r\n");
      out.write("\r\n");
      out.write("<script>\r\n");
      out.write("    $(document).ready(function () {\r\n");
      out.write("        function getContextPath() {\r\n");
      out.write("            return window.location.pathname.substring(0, window.location.pathname.indexOf(\"/\", 2));\r\n");
      out.write("        }       \r\n");
      out.write("\r\n");
      out.write("        // Ambil tahun sekarang\r\n");
      out.write("        const currentYear = new Date().getFullYear();\r\n");
      out.write("\r\n");
      out.write("        // Hitung range\r\n");
      out.write("        const startYear = currentYear - 5;\r\n");
      out.write("        const endYear = currentYear + 5;\r\n");
      out.write("\r\n");
      out.write("        const select = document.getElementById(\"tahun_laporan\");\r\n");
      out.write("\r\n");
      out.write("        // Generate dropdown tahun\r\n");
      out.write("        for (let y = startYear; y <= endYear; y++) {\r\n");
      out.write("            const opt = document.createElement(\"option\");\r\n");
      out.write("            opt.value = y;\r\n");
      out.write("            opt.textContent = y;\r\n");
      out.write("\r\n");
      out.write("            // Set default tahun sekarang\r\n");
      out.write("            if (y === currentYear) {\r\n");
      out.write("                opt.selected = true;\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            select.appendChild(opt);\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        let detailFilterParams = {};\r\n");
      out.write("\r\n");
      out.write("        // memembat format number digit\r\n");
      out.write("        function formatNumber(value, fractionDigits = 2) {\r\n");
      out.write("            if (value == null || value === '') return '';\r\n");
      out.write("            const number = parseFloat(value);\r\n");
      out.write("            if (isNaN(number)) return value;\r\n");
      out.write("            return number.toLocaleString('id-ID', {\r\n");
      out.write("                minimumFractionDigits: fractionDigits,\r\n");
      out.write("                maximumFractionDigits: fractionDigits\r\n");
      out.write("            });\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        // ---------------------------------------------------------------------------------------------\r\n");
      out.write("        // 1A-1) Tampilkan monitoring Rekap\r\n");
      out.write("        // ---------------------------------------------------------------------------------------------\r\n");
      out.write("        var table = $('#tablemon_upi').DataTable({\r\n");
      out.write("            processing: false,\r\n");
      out.write("            serverSide: true,\r\n");
      out.write("            scrollX: false,\r\n");
      out.write("            paging: false, // MATIKAN PAGING\r\n");
      out.write("            stripeClasses: [], // Nonaktifkan efek baris selang-seling\r\n");
      out.write("            searching: false, \r\n");
      out.write("            autoWidth: false,\r\n");
      out.write("            ajax: {\r\n");
      out.write("                url:  getContextPath() + '/mon-pengerjaan-perprovupi',\r\n");
      out.write("                type: 'POST',\r\n");
      out.write("                data: function (d) {\r\n");
      out.write("                    d.vtahun_laporan = $('#tahun_laporan').val();// pastikan pakai '#'!\r\n");
      out.write("                }\r\n");
      out.write("            },\r\n");
      out.write("            columns: [\r\n");
      out.write("                {\r\n");
      out.write("                    data: null,\r\n");
      out.write("                    render: function (data, type, row, meta) {\r\n");
      out.write("                        if (row.KD_PROV !== null && row.KD_PROV !== undefined) {\r\n");
      out.write("                            return meta.row + 1 + meta.settings._iDisplayStart;\r\n");
      out.write("                        } else {\r\n");
      out.write("                            return ''; // atau bisa juga 'N/A' atau '-'\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("                },\r\n");
      out.write("                { data: 'TAHUN',  defaultContent: '' },\r\n");
      out.write("                { data: 'KD_PROV',  defaultContent: '' },\r\n");
      out.write("                { data: 'PROVINSI',  defaultContent: '' },\r\n");
      out.write("                // kolom numeric diformat pakai formatNumber\r\n");
      out.write("                { data: 'JTR_RENCANA', defaultContent: '', render: d => formatNumber(d, 0) },\r\n");
      out.write("                { data: 'JTM_RENCANA', defaultContent: '', render: d => formatNumber(d, 0) },\r\n");
      out.write("                { data: 'GRD_RENCANA', defaultContent: '', render: d => formatNumber(d, 0) },\r\n");
      out.write("                { data: 'JTR_WO', defaultContent: '', render: d => formatNumber(d, 0) },\r\n");
      out.write("                { data: 'JTM_WO', defaultContent: '', render: d => formatNumber(d, 0) },\r\n");
      out.write("                { data: 'GRD_WO', defaultContent: '', render: d => formatNumber(d, 0) },\r\n");
      out.write("                { data: 'JTR_PROGRES', defaultContent: '', render: d => formatNumber(d, 0) },\r\n");
      out.write("                { data: 'JTM_PROGRES', defaultContent: '', render: d => formatNumber(d, 0) },\r\n");
      out.write("                { data: 'GRD_PROGRES', defaultContent: '', render: d => formatNumber(d, 0) },\r\n");
      out.write("                { data: 'JTR_KOREKSI', defaultContent: '', render: d => formatNumber(d, 0) },\r\n");
      out.write("                { data: 'JTM_KOREKSI', defaultContent: '', render: d => formatNumber(d, 0) },\r\n");
      out.write("                { data: 'GRD_KOREKSI', defaultContent: '', render: d => formatNumber(d, 0) },\r\n");
      out.write("                { data: 'JTR_PASANG', defaultContent: '', render: d => formatNumber(d, 0) },\r\n");
      out.write("                { data: 'JTM_PASANG', defaultContent: '', render: d => formatNumber(d, 0) },\r\n");
      out.write("                { data: 'GRD_PASANG', defaultContent: '', render: d => formatNumber(d, 0) },\r\n");
      out.write("                { data: 'JTR_PROSEN', defaultContent: '', render: d => formatNumber(d, 0) },\r\n");
      out.write("                { data: 'JTM_PROSEN', defaultContent: '', render: d => formatNumber(d, 0) },\r\n");
      out.write("                { data: 'GRD_PROSEN', defaultContent: '', render: d => formatNumber(d, 0) }\r\n");
      out.write("            ],\r\n");
      out.write("\r\n");
      out.write("            drawCallback: function () {\r\n");
      out.write("                $('#tablemon_upi thead th').addClass('text-center');\r\n");
      out.write("            },\r\n");
      out.write("           columnDefs: [\r\n");
      out.write("                { targets: '_all', className: 'dt-center' },\r\n");
      out.write("                { targets: 0, className: 'dt-body-right', orderable: false, searchable: false, width: '5px' },  \r\n");
      out.write("                { targets: 1, className: 'dt-body-center', width: '5px' },                         \r\n");
      out.write("                { targets: 2, className: 'dt-body-center', width: '5px' },                       \r\n");
      out.write("                { targets: 3, className: 'dt-body-center', width: '50px' },                         \r\n");
      out.write("                { targets: 4, className: 'dt-body-center', width: '50px' },                        \r\n");
      out.write("                { targets: 5, className: 'dt-body-center', width: '50px' },                        \r\n");
      out.write("                { targets: 6, className: 'dt-body-center', width: '50px' },   \r\n");
      out.write("                { targets: 7, className: 'dt-body-center', width: '50px' },                        \r\n");
      out.write("                { targets: 8, className: 'dt-body-center', width: '50px' },                        \r\n");
      out.write("                { targets: 9, className: 'dt-body-center', width: '50px' },                         \r\n");
      out.write("            ],\r\n");
      out.write("            createdRow: function (row, data, dataIndex) {\r\n");
      out.write("                $('td', row).each(function (colIndex) {\r\n");
      out.write("\r\n");
      out.write("                    const columnDef = table.settings()[0].aoColumns[colIndex];\r\n");
      out.write("                    const columnName = columnDef.data;\r\n");
      out.write("                    if (!columnName) return;\r\n");
      out.write("\r\n");
      out.write("                    const cellValue = data[columnName];\r\n");
      out.write("                    const allowedColumns = ['JTR_RENCANA', 'JTM_RENCANA', 'GRD_RENCANA',\r\n");
      out.write("                                            'JTR_WO', 'JTM_WO', 'GRD_WO',\r\n");
      out.write("                                            'JTR_PROGRES', 'JTM_PROGRES', 'GRD_PROGRES',            \r\n");
      out.write("                                            'JTR_KOREKSI', 'JTM_KOREKSI', 'GRD_KOREKSI',            \r\n");
      out.write("                                            'JTR_PASANG', 'JTM_PASANG', 'GRD_PASANG',            \r\n");
      out.write("                                           ];\r\n");
      out.write("\r\n");
      out.write("                    if (\r\n");
      out.write("                        allowedColumns.includes(columnName) &&\r\n");
      out.write("                        typeof cellValue === 'string' &&\r\n");
      out.write("                        cellValue.trim() !== '' &&\r\n");
      out.write("                        (data.URUT == 1)\r\n");
      out.write("                    ) {\r\n");
      out.write("                        // ===== RESET STYLE & CLICK (WAJIB) =====\r\n");
      out.write("                        $(this)\r\n");
      out.write("                            .removeClass('dt-clickable-bold')\r\n");
      out.write("                            .css({\r\n");
      out.write("                                cursor: 'default',\r\n");
      out.write("                                'text-decoration': 'none',\r\n");
      out.write("                                color: '',\r\n");
      out.write("                                'font-weight': 'bold',\r\n");
      out.write("                            })\r\n");
      out.write("                            .off('click');\r\n");
      out.write("\r\n");
      out.write("                        // ==============================\r\n");
      out.write("                        // Normalisasi nilai kolom\r\n");
      out.write("                        // ==============================\r\n");
      out.write("                        let valT = 0, valK = 0, valA = 0;\r\n");
      out.write("\r\n");
      out.write("                        // Versi 1: T=..|K=..|A=..\r\n");
      out.write("                        if (cellValue.includes('T=')) {\r\n");
      out.write("                            const t = cellValue.match(/T=\\s*(\\d+)/);\r\n");
      out.write("                            const k = cellValue.match(/K=\\s*(\\d+)/);\r\n");
      out.write("                            const a = cellValue.match(/A=\\s*(\\d+)/);\r\n");
      out.write("\r\n");
      out.write("                            valT = t ? parseInt(t[1], 10) : 0;\r\n");
      out.write("                            valK = k ? parseInt(k[1], 10) : 0;\r\n");
      out.write("                            valA = a ? parseInt(a[1], 10) : 0;\r\n");
      out.write("                        }\r\n");
      out.write("                        // Versi 2: hanya angka â†’ Tiang\r\n");
      out.write("                        else if (!isNaN(cellValue)) {\r\n");
      out.write("                            valT = parseInt(cellValue, 10);\r\n");
      out.write("                        }\r\n");
      out.write("\r\n");
      out.write("                        // ==============================\r\n");
      out.write("                        // Reset style & click (WAJIB)\r\n");
      out.write("                        // ==============================\r\n");
      out.write("                        $(this)\r\n");
      out.write("                            .css({\r\n");
      out.write("                                cursor: 'default',\r\n");
      out.write("                                'text-decoration': 'none',\r\n");
      out.write("                                'font-weight': 'normal',\r\n");
      out.write("                                color: ''\r\n");
      out.write("                            })\r\n");
      out.write("                            .off('click');\r\n");
      out.write("\r\n");
      out.write("                        // ==============================\r\n");
      out.write("                        // Jika SEMUA 0 â†’ STOP\r\n");
      out.write("                        // ==============================\r\n");
      out.write("                        if (valT === 0 && valK === 0 && valA === 0) {\r\n");
      out.write("                            return;\r\n");
      out.write("                        }\r\n");
      out.write("\r\n");
      out.write("                        // ==============================\r\n");
      out.write("                        // Aktifkan underline & modal\r\n");
      out.write("                        // ==============================\r\n");
      out.write("                        $(this).css({\r\n");
      out.write("                            cursor: 'pointer',\r\n");
      out.write("                            'text-decoration': 'underline',\r\n");
      out.write("                            'font-weight': 'bold',\r\n");
      out.write("                            color: 'blue'\r\n");
      out.write("                        }).on('click', function () {\r\n");
      out.write("\r\n");
      out.write("                            $('#xtahun_laporan').val(data.TAHUN);\r\n");
      out.write("                            $('#xkd_dist').val(data.KD_DIST);\r\n");
      out.write("\r\n");
      out.write("                            detailFilterParams = {\r\n");
      out.write("                                vtahun_laporan: data.TAHUN,\r\n");
      out.write("                                vkd_prov: data.KD_PROV,\r\n");
      out.write("                                vnama_prov: data.PROVINSI,\r\n");
      out.write("                                vinfolabel: columnName\r\n");
      out.write("                            };\r\n");
      out.write("\r\n");
      out.write("                            console.log('Updated filter params:', detailFilterParams);\r\n");
      out.write("                            $('#dataModal').modal('show');\r\n");
      out.write("                        });\r\n");
      out.write("\r\n");
      out.write("                    }\r\n");
      out.write("                });\r\n");
      out.write("            },\r\n");
      out.write("            // dom: 'lfrtip'\r\n");
      out.write("            dom: 'Bfrtip',\r\n");
      out.write("            buttons: [\r\n");
      out.write("                    {\r\n");
      out.write("                        extend: 'excelHtml5',\r\n");
      out.write("                        title: 'REKAP_PENGERJAAN_PEMASANGAN_' + $('#tahun_laporan').val(),\r\n");
      out.write("                        className: 'd-none',\r\n");
      out.write("                        exportOptions: {\r\n");
      out.write("                            format: {\r\n");
      out.write("                                body: function (data, row, column, node) {\r\n");
      out.write("                                    // Ambil semua kolom yang menggunakan formatNumber\r\n");
      out.write("                                    // const columnsRaw = [5,6,7,8,9,10,11]; // indeks kolom sesuai urutan kolom PLN_IDPEL - SELISIH_RPTAG\r\n");
      out.write("\r\n");
      out.write("                                    // Jika kolom termasuk dalam Detail, hilangkan format ribuan (misal: \"1.000.000\" jadi \"1000000\")\r\n");
      out.write("                                    if (columnsRaw.includes(column)) {\r\n");
      out.write("                                        if (typeof data === 'string') {\r\n");
      out.write("                                            // Hilangkan titik ribuan dan koma desimal jika perlu\r\n");
      out.write("                                            return data.replace(/\\./g, '').replace(/,/g, '');\r\n");
      out.write("                                        }\r\n");
      out.write("                                        return data;\r\n");
      out.write("                                    }\r\n");
      out.write("                                    return data;\r\n");
      out.write("                                }\r\n");
      out.write("                            }\r\n");
      out.write("                        },\r\n");
      out.write("                        customize: function (xlsx) {\r\n");
      out.write("                            const sheet = xlsx.xl.worksheets['sheet1.xml'];\r\n");
      out.write("                            const sheetData = $('sheetData', sheet);\r\n");
      out.write("\r\n");
      out.write("                            const now = new Date();\r\n");
      out.write("                            const dd = String(now.getDate()).padStart(2, '0');\r\n");
      out.write("                            const mm = String(now.getMonth() + 1).padStart(2, '0');\r\n");
      out.write("                            const yyyy = now.getFullYear();\r\n");
      out.write("                            const hh = String(now.getHours()).padStart(2, '0');\r\n");
      out.write("                            const mi = String(now.getMinutes()).padStart(2, '0');\r\n");
      out.write("                            const ss = String(now.getSeconds()).padStart(2, '0');\r\n");
      out.write("                            const timestamp = dd+\"/\"+mm+\"/\"+yyyy+\" \"+hh+\":\"+mi+\":\"+ss;\r\n");
      out.write("                            const judul = \"_REKAP_\" + $('#tahun_laporan').val();\r\n");
      out.write("\r\n");
      out.write("                            // Tambahkan judul dan timestamp jika dibutuhkan\r\n");
      out.write("                            // ...\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("                ]            \r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        // Tampilkan spinnerOverlay saat DataTables mulai load data\r\n");
      out.write("        table.on('preXhr.dt', function () {\r\n");
      out.write("           $('#spinnerOverlay').show();  \r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        // Sembunyikan spinnerOverlay setelah DataTables selesai load data\r\n");
      out.write("        table.on('xhr.dt', function () {\r\n");
      out.write("            $('#spinnerOverlay').hide();    // Saat selesai\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        $('#btnTampil').on('click', function () {\r\n");
      out.write("            if (!$('#tahun_laporan').val()) {\r\n");
      out.write("                alert(\"Silakan pilih Tahun Laporan terlebih dahulu!\");\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            $('#spinnerOverlay').show();   // hanya tampilkan overlay modal\r\n");
      out.write("            table.ajax.reload();\r\n");
      out.write("        });\r\n");
      out.write("         \r\n");
      out.write("        // ---------------------------------------------------------------------------------------------\r\n");
      out.write("        // 1A-2) Ekspor halaman Monitoring Rekap ke Excel\r\n");
      out.write("        // ---------------------------------------------------------------------------------------------\r\n");
      out.write("        // $('#btnExportMonRkpAllExcel').on('click', function () {\r\n");
      out.write("        //     table.button('.buttons-excel').trigger();\r\n");
      out.write("        // });\r\n");
      out.write("\r\n");
      out.write("        async function exportRekapPengerjaanExcel(vtahun_laporan) {\r\n");
      out.write("\r\n");
      out.write("            if (!vtahun_laporan) {\r\n");
      out.write("                alert(\"Silakan isi Tahun Laporan terlebih dahulu.\");\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            const btn = $('#btnExportMonRkpAllExcel2');\r\n");
      out.write("            $('#spinnerOverlay').show();\r\n");
      out.write("            btn.prop('disabled', true).text(\"Memuat... (0 data)\");\r\n");
      out.write("\r\n");
      out.write("            try {\r\n");
      out.write("\r\n");
      out.write("                // ============================================================\r\n");
      out.write("                // 1. LOAD DATA\r\n");
      out.write("                // ============================================================\r\n");
      out.write("                let allData = [];\r\n");
      out.write("\r\n");
      out.write("                const headers = [\r\n");
      out.write("                    \"NO\",\r\n");
      out.write("                    \"TAHUN\",\r\n");
      out.write("                    \"KD_PROV\",\r\n");
      out.write("                    \"PROVINSI\",\r\n");
      out.write("                    \"JTR_RENCANA\", \r\n");
      out.write("                    \"JTM_RENCANA\",\r\n");
      out.write("                    \"GRD_RENCANA\",\r\n");
      out.write("                    \"JTR_WO\", \r\n");
      out.write("                    \"JTM_WO\", \r\n");
      out.write("                    \"GRD_WO\",\r\n");
      out.write("                    \"JTR_PROGRES\", \r\n");
      out.write("                    \"JTM_PROGRES\", \r\n");
      out.write("                    \"GRD_PROGRES\", \r\n");
      out.write("                    \"JTR_FINAL\", \r\n");
      out.write("                    \"JTM_FINAL\", \r\n");
      out.write("                    \"GRD_FINAL\", \r\n");
      out.write("                    \"JTR_PROSEN\", \r\n");
      out.write("                    \"JTM_PROSEN\", \r\n");
      out.write("                    \"GRD_PROSEN\"\r\n");
      out.write("                ];\r\n");
      out.write("\r\n");
      out.write("                const params = new URLSearchParams();\r\n");
      out.write("                params.append(\"vtahun_laporan\", vtahun_laporan);\r\n");
      out.write("\r\n");
      out.write("                const response = await fetch(\r\n");
      out.write("                    getContextPath() + '/mon-pengerjaan-perprovupi',\r\n");
      out.write("                    {\r\n");
      out.write("                        method: \"POST\",\r\n");
      out.write("                        headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n");
      out.write("                        body: params\r\n");
      out.write("                    }\r\n");
      out.write("                );\r\n");
      out.write("\r\n");
      out.write("                if (!response.ok) {\r\n");
      out.write("                    throw new Error(\"HTTP Error \" + response.status);\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                const json = await response.json();\r\n");
      out.write("                const data = json.data || [];\r\n");
      out.write("\r\n");
      out.write("                if (data.length === 0) {\r\n");
      out.write("                    alert(\"Tidak ada data untuk diekspor.\");\r\n");
      out.write("                    return;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                data.forEach(function (item, idx) {\r\n");
      out.write("                    allData.push([\r\n");
      out.write("                        item.URUT != 5 ? (idx + 1) : \"\",\r\n");
      out.write("                        item.TAHUN || \"\",\r\n");
      out.write("                        item.KD_PROV || \"\",\r\n");
      out.write("                        item.PROVINSI || \"\",\r\n");
      out.write("                        item.JTR_RENCANA || \"\",\r\n");
      out.write("                        item.JTM_RENCANA || \"\",\r\n");
      out.write("                        item.GRD_RENCANA || \"\",\r\n");
      out.write("                        item.JTR_WO || \"\",\r\n");
      out.write("                        item.JTM_WO || \"\",\r\n");
      out.write("                        item.GRD_WO || \"\",\r\n");
      out.write("                        item.JTR_PROGRES || \"\",\r\n");
      out.write("                        item.JTM_PROGRES || \"\",\r\n");
      out.write("                        item.GRD_PROGRES || \"\",\r\n");
      out.write("                        item.JTR_FINAL   || \"\",\r\n");
      out.write("                        item.JTM_FINAL   || \"\",\r\n");
      out.write("                        item.GRD_FINAL   || \"\",\r\n");
      out.write("                        item.JTR_PROSEN  || \"\",\r\n");
      out.write("                        item.JTM_PROSEN  || \"\",\r\n");
      out.write("                        item.GRD_PROSEN  || \"\"\r\n");
      out.write("                    ]);\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                // ============================================================\r\n");
      out.write("                // 2. AOA (Array of Array)\r\n");
      out.write("                // ============================================================\r\n");
      out.write("                const timestamp = new Date().toLocaleString(\"id-ID\");\r\n");
      out.write("\r\n");
      out.write("                const rows = [\r\n");
      out.write("                    [\"LISA - REKAP PENGERJAAN PEKERJAAN\"],\r\n");
      out.write("                    [\"TAHUN\", \": \" + vtahun_laporan],\r\n");
      out.write("                    [\"TANGGAL DOWNLOAD\", \": \" + timestamp],\r\n");
      out.write("                    [],\r\n");
      out.write("                    [\r\n");
      out.write("                        \"NO\", \"TAHUN\", \"KD_PROV\", \"PROVINSI\",\r\n");
      out.write("                        \"RENCANA\", \"\", \"\",\r\n");
      out.write("                        \"WORK ORDER\", \"\", \"\",\r\n");
      out.write("                        \"PROSES BANGSANG\", \"\", \"\",\r\n");
      out.write("                        \"KOREKSI BANGSANG\", \"\", \"\",\r\n");
      out.write("                        \"TERPASANG BANGSANG\", \"\", \"\",\r\n");
      out.write("                        \"PORSENTASE (%)\", \"\", \"\"\r\n");
      out.write("                    ],\r\n");
      out.write("                    [\r\n");
      out.write("                        \"\", \"\", \"\", \"\",\r\n");
      out.write("                        \"JTR\", \"JTM\", \"GRD\",\r\n");
      out.write("                        \"JTR\", \"JTM\", \"GRD\",\r\n");
      out.write("                        \"JTR\", \"JTM\", \"GRD\",\r\n");
      out.write("                        \"JTR\", \"JTM\", \"GRD\",\r\n");
      out.write("                        \"JTR\", \"JTM\", \"GRD\",\r\n");
      out.write("                        \"JTR\", \"JTM\", \"GRD\"\r\n");
      out.write("                    ]\r\n");
      out.write("                ].concat(allData);\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("                // ============================================================\r\n");
      out.write("                // 3. SHEETJS\r\n");
      out.write("                // ============================================================\r\n");
      out.write("                const ws = XLSX.utils.aoa_to_sheet(rows);\r\n");
      out.write("                const wb = XLSX.utils.book_new();\r\n");
      out.write("                XLSX.utils.book_append_sheet(wb, ws, \"REKAP\");\r\n");
      out.write("\r\n");
      out.write("                const wbout = XLSX.write(wb, {\r\n");
      out.write("                    bookType: \"xlsx\",\r\n");
      out.write("                    type: \"array\"\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                // ============================================================\r\n");
      out.write("                // 4. XLSXPOPULATE STYLING\r\n");
      out.write("                // ============================================================\r\n");
      out.write("                const filename =\r\n");
      out.write("                    'REKAP_PENGERJAAN_PEMASANGAN_PROV_' + vtahun_laporan + '.xlsx';\r\n");
      out.write("\r\n");
      out.write("                await XlsxPopulate.fromDataAsync(wbout)\r\n");
      out.write("                    .then(function (workbook) {\r\n");
      out.write("                    \r\n");
      out.write("                        const sheet = workbook.sheet(0);\r\n");
      out.write("                        const totalCols = headers.length; // 22 kolom (Aâ€“V)\r\n");
      out.write("                        const lastCol = \"V\";\r\n");
      out.write("                        const lastRow = rows.length;\r\n");
      out.write("\r\n");
      out.write("                        // ===============================\r\n");
      out.write("                        // MERGE HEADER (2 LEVEL)\r\n");
      out.write("                        // ===============================\r\n");
      out.write("                        sheet.range(\"A5:A6\").merged(true);\r\n");
      out.write("                        sheet.range(\"B5:B6\").merged(true);\r\n");
      out.write("                        sheet.range(\"C5:C6\").merged(true);\r\n");
      out.write("                        sheet.range(\"D5:D6\").merged(true);\r\n");
      out.write("\r\n");
      out.write("                        sheet.range(\"E5:G5\").merged(true);   // RENCANA\r\n");
      out.write("                        sheet.range(\"H5:J5\").merged(true);   // WORK ORDER\r\n");
      out.write("                        sheet.range(\"K5:M5\").merged(true);   // PROSES\r\n");
      out.write("                        sheet.range(\"N5:P5\").merged(true);   // KOREKSI\r\n");
      out.write("                        sheet.range(\"Q5:S5\").merged(true);   // TERPASANG\r\n");
      out.write("                        sheet.range(\"T5:V5\").merged(true);   // PORSENTASE\r\n");
      out.write("\r\n");
      out.write("                        // ===============================\r\n");
      out.write("                        // STYLE HEADER (BIRU)\r\n");
      out.write("                        // ===============================\r\n");
      out.write("                        sheet.range(\"A5:V6\").style({\r\n");
      out.write("                            bold: true,\r\n");
      out.write("                            fill: \"5B8CC9\",\r\n");
      out.write("                            fontColor: \"FFFFFF\",\r\n");
      out.write("                            border: true,\r\n");
      out.write("                            horizontalAlignment: \"center\",\r\n");
      out.write("                            verticalAlignment: \"center\"\r\n");
      out.write("                        });\r\n");
      out.write("\r\n");
      out.write("                        // ===============================\r\n");
      out.write("                        // FILTER HEADER (sub-header)\r\n");
      out.write("                        // ===============================\r\n");
      out.write("                        sheet.range(\"A6:V6\").autoFilter();\r\n");
      out.write("\r\n");
      out.write("                        // ===============================\r\n");
      out.write("                        // BORDER DATA\r\n");
      out.write("                        // ===============================\r\n");
      out.write("                        sheet.range(\"A5:\" + lastCol + lastRow)\r\n");
      out.write("                            .style({ border: true });\r\n");
      out.write("\r\n");
      out.write("                        // ===============================\r\n");
      out.write("                        // BOLD KOLOM D â€“ S (ANGKA)\r\n");
      out.write("                        // ===============================\r\n");
      out.write("                        const startDataRow = 7; // data dimulai setelah 2 baris header\r\n");
      out.write("                        for (let col = 4; col <= 22; col++) {\r\n");
      out.write("                            sheet.range(\r\n");
      out.write("                                sheet.cell(startDataRow, col),\r\n");
      out.write("                                sheet.cell(lastRow, col)\r\n");
      out.write("                            ).style({ bold: true });\r\n");
      out.write("                        }\r\n");
      out.write("\r\n");
      out.write("                        // ===============================\r\n");
      out.write("                        // LEBAR KOLOM\r\n");
      out.write("                        // ===============================\r\n");
      out.write("                        for (let c = 1; c <= totalCols; c++) {\r\n");
      out.write("                            sheet.column(c).width(22);\r\n");
      out.write("                        }\r\n");
      out.write("\r\n");
      out.write("                        return workbook.outputAsync();\r\n");
      out.write("                    })\r\n");
      out.write("                    .then(function (blob) {\r\n");
      out.write("                        saveAs(blob, filename);\r\n");
      out.write("                    });  \r\n");
      out.write("\r\n");
      out.write("            } catch (e) {\r\n");
      out.write("                console.error(e);\r\n");
      out.write("                alert(\"Terjadi error: \" + e.message);\r\n");
      out.write("            } finally {\r\n");
      out.write("                btn.prop('disabled', false).text(\"Export Excel Rekap\");\r\n");
      out.write("                $('#spinnerOverlay').hide();\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("    \r\n");
      out.write("        $('#btnExportMonRkpAllExcel2').on('click', async function () {\r\n");
      out.write("            exportRekapPengerjaanExcel($('#tahun_laporan').val());\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("// X=========================================================================================================================\r\n");
      out.write("        // ---------------------------------------------------------------------------------------------\r\n");
      out.write("        // 1B-1) show Data Monitoring Detail/Detail PerUpi Modal Large \r\n");
      out.write("        // ---------------------------------------------------------------------------------------------\r\n");
      out.write("        let lastPageBeforeSearchDetail = 0;\r\n");
      out.write("        let detailTable = null;\r\n");
      out.write("\r\n");
      out.write("        $('#dataModal').on('shown.bs.modal', function () {\r\n");
      out.write("\r\n");
      out.write("            $('#dataModalLabel').text('Detail Data : ' + detailFilterParams.vinfolabel);\r\n");
      out.write("\r\n");
      out.write("            // ðŸ”¥ Jika tabel sudah ada â†’ reload saja\r\n");
      out.write("            if (detailTable) {\r\n");
      out.write("                detailTable.ajax.reload(null, true);\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            // ðŸ”¥ Inisialisasi DataTable\r\n");
      out.write("            detailTable = $('#table_mondaf_provupi').DataTable({\r\n");
      out.write("                processing: true,\r\n");
      out.write("                serverSide: true,\r\n");
      out.write("                scrollX: true,\r\n");
      out.write("                ajax: {\r\n");
      out.write("                    url: getContextPath() + '/mon-pengerjaan-perprovupi',\r\n");
      out.write("                    type: 'POST',\r\n");
      out.write("                    data: function (d) {\r\n");
      out.write("                        // d.act = 'detailData'; \r\n");
      out.write("                        d.act = 'detailDatav3';\r\n");
      out.write("                        d.vtahun_laporan = detailFilterParams.vtahun_laporan;\r\n");
      out.write("                        d.vkd_prov = detailFilterParams.vkd_prov;\r\n");
      out.write("                        d.vinfolabel = detailFilterParams.vinfolabel;\r\n");
      out.write("                        console.log('Kirim data ke server:', d);\r\n");
      out.write("                    },\r\n");
      out.write("                    dataSrc: function (json) {\r\n");
      out.write("                        console.log('Response dari server:', json);\r\n");
      out.write("                        return json.data || [];\r\n");
      out.write("                    }\r\n");
      out.write("                },\r\n");
      out.write("                columns: [\r\n");
      out.write("                    { data: null, orderable: false, className: 'text-center', render: (data, type, row, meta) => meta.row + meta.settings._iDisplayStart + 1 },\r\n");
      out.write("                    {data:'INFOLABEL'},\r\n");
      out.write("                    {data:'NOMOR_KONTRAK_RINCI'},\r\n");
      out.write("                    {data:'KATEGORI_PEMBANGUNAN'},\r\n");
      out.write("                    {data:'TRANSMISI'},\r\n");
      out.write("                    {data:'MATERIAL_GROUP'},\r\n");
      out.write("                    {data:'KODE_MATERIAL'},\r\n");
      out.write("                    {data:'NAMA_MATERIAL'},\r\n");
      out.write("                    {data:'JUMLAH_MDU'},\r\n");
      out.write("                    {data:'SATUAN'},\r\n");
      out.write("                    {data:'ID_TIANG'},\r\n");
      out.write("                    {data:'STATUS'},\r\n");
      out.write("                    {data:'TAHUN'},\r\n");
      out.write("                    {data:'KD_PROV'},\r\n");
      out.write("                    {data:'PROVINSI'},\r\n");
      out.write("                    {data:'KD_KAB'},\r\n");
      out.write("                    {data:'KABUPATENKOTA'},\r\n");
      out.write("                    {data:'KD_KEC'},\r\n");
      out.write("                    {data:'KECAMATAN'},\r\n");
      out.write("                    {data:'KD_KEL'},\r\n");
      out.write("                    {data:'DESAKELURAHAN'},\r\n");
      out.write("                    {data:'UNITUPI'},\r\n");
      out.write("                    {data:'UNITAP'},\r\n");
      out.write("                    {data:'UNITUP'},\r\n");
      out.write("                    {data:'ID_PERENCANAAN'},\r\n");
      out.write("                    {data:'NOMOR_KONTRAK'},\r\n");
      out.write("                    {data:'KODE_PEMBANGUNAN'},\r\n");
      out.write("                    {data:'MATERIAL_GROUP_ID'},\r\n");
      out.write("                    {data:'ROW_ITEMS'},\r\n");
      out.write("                    {data:'TOTAL_ITEMS'}\r\n");
      out.write("                ],\r\n");
      out.write("\r\n");
      out.write("                // ðŸ”¥ Format cell\r\n");
      out.write("                createdRow: function (row, data) {\r\n");
      out.write("                    const api = this.api();\r\n");
      out.write("                    const allowedColumns = [\r\n");
      out.write("                        'KATEGORI_PEMBANGUNAN',\r\n");
      out.write("                        'MATERIAL_GROUP',\r\n");
      out.write("                        'KODE_MATERIAL',\r\n");
      out.write("                        'NAMA_MATERIAL',\r\n");
      out.write("                        'JUMLAH_MDU',\r\n");
      out.write("                        'SATUAN',\r\n");
      out.write("                        'NOMOR_KONTRAK_RINCI'\r\n");
      out.write("                    ];\r\n");
      out.write("\r\n");
      out.write("                    $('td', row).each(function (colIndex) {\r\n");
      out.write("                        const columnDef = api.settings()[0].aoColumns[colIndex];\r\n");
      out.write("                        const columnName = columnDef.data;\r\n");
      out.write("                        if (!columnName || !allowedColumns.includes(columnName)) return;\r\n");
      out.write("\r\n");
      out.write("                        const cellValue = data[columnName];\r\n");
      out.write("                        const formattedValue = columnName === 'JUMLAH_MDU' ? formatNumber(cellValue, 0) : cellValue;\r\n");
      out.write("\r\n");
      out.write("                        $(this)\r\n");
      out.write("                            .text(formattedValue)\r\n");
      out.write("                            .addClass('dt-clickable-bold')\r\n");
      out.write("                            .css({\r\n");
      out.write("                                cursor: 'pointer',\r\n");
      out.write("                                'font-weight': 'bold',\r\n");
      out.write("                                'text-align': columnName === 'JUMLAH_MDU' ? 'right' : 'left'\r\n");
      out.write("                            });\r\n");
      out.write("                    });\r\n");
      out.write("                },\r\n");
      out.write("\r\n");
      out.write("                // ðŸ”¥ Subtotal + garis akhir NOMOR_KONTRAK_RINCI\r\n");
      out.write("                // drawCallback: function () {\r\n");
      out.write("                //     const api = this.api();\r\n");
      out.write("                //     const rowsData = api.rows({ page: 'current' }).data();\r\n");
      out.write("                //     const rowsNodes = api.rows({ page: 'current' }).nodes();\r\n");
      out.write("                //     if (!rowsData.length) return;\r\n");
      out.write("\r\n");
      out.write("                //     const $tbody = $(rowsNodes).closest('tbody');\r\n");
      out.write("\r\n");
      out.write("                //     // bersihkan dulu\r\n");
      out.write("                //     $tbody.find(\r\n");
      out.write("                //         'tr.subtotal-row, tr.start-kontrak-row, tr.end-kontrak-row'\r\n");
      out.write("                //     ).remove();\r\n");
      out.write("\r\n");
      out.write("                //     let lastKontrak = null;\r\n");
      out.write("                //     let lastGroup   = null;\r\n");
      out.write("                //     let subtotal    = 0;\r\n");
      out.write("\r\n");
      out.write("                //     const colQtyIndex = api.settings()[0].aoColumns.findIndex(\r\n");
      out.write("                //         c => c.data === 'JUMLAH_MDU'\r\n");
      out.write("                //     );\r\n");
      out.write("\r\n");
      out.write("                //     rowsData.each(function (rowData, i) {\r\n");
      out.write("\r\n");
      out.write("                //         const kontrak = (rowData.NOMOR_KONTRAK_RINCI || '').trim();\r\n");
      out.write("                //         const group   = (rowData.MATERIAL_GROUP || '(TANPA GROUP)').trim();\r\n");
      out.write("                //         const qty     = Number(rowData.JUMLAH_MDU) || 0;\r\n");
      out.write("\r\n");
      out.write("                //         const prevRow = rowsData[i - 1];\r\n");
      out.write("                //         const nextRow = rowsData[i + 1];\r\n");
      out.write("\r\n");
      out.write("                //         /* ==========================\r\n");
      out.write("                //         * START KONTRAK\r\n");
      out.write("                //         * ========================== */\r\n");
      out.write("                //         if (!prevRow || prevRow.NOMOR_KONTRAK_RINCI !== kontrak) {\r\n");
      out.write("                //             insertStartOfKontrak(rowsNodes[i], kontrak);\r\n");
      out.write("                //         }\r\n");
      out.write("\r\n");
      out.write("                //         /* ==========================\r\n");
      out.write("                //         * GANTI GROUP\r\n");
      out.write("                //         * ========================== */\r\n");
      out.write("                //         if (lastGroup && group !== lastGroup) {\r\n");
      out.write("                //             insertSubtotal(rowsNodes[i], lastGroup, subtotal);\r\n");
      out.write("                //             subtotal = 0;\r\n");
      out.write("                //         }\r\n");
      out.write("\r\n");
      out.write("                //         subtotal   += qty;\r\n");
      out.write("                //         lastGroup   = group;\r\n");
      out.write("                //         lastKontrak = kontrak;\r\n");
      out.write("\r\n");
      out.write("                //         /* ==========================\r\n");
      out.write("                //         * END KONTRAK\r\n");
      out.write("                //         * ========================== */\r\n");
      out.write("                //         if (!nextRow || nextRow.NOMOR_KONTRAK_RINCI !== kontrak) {\r\n");
      out.write("                //             insertSubtotal(\r\n");
      out.write("                //                 nextRow ? rowsNodes[i + 1] : null,\r\n");
      out.write("                //                 group,\r\n");
      out.write("                //                 subtotal\r\n");
      out.write("                //             );\r\n");
      out.write("                //             insertEndOfKontrak(\r\n");
      out.write("                //                 nextRow ? rowsNodes[i + 1] : null,\r\n");
      out.write("                //                 kontrak\r\n");
      out.write("                //             );\r\n");
      out.write("                //             subtotal  = 0;\r\n");
      out.write("                //             lastGroup = null;\r\n");
      out.write("                //         }\r\n");
      out.write("                //     });\r\n");
      out.write("\r\n");
      out.write("                //     /* ==========================\r\n");
      out.write("                //     * FUNCTIONS\r\n");
      out.write("                //     * ========================== */\r\n");
      out.write("\r\n");
      out.write("                //     function insertStartOfKontrak(refNode, kontrak) {\r\n");
      out.write("                //         if (!kontrak) return;\r\n");
      out.write("                //         const totalCols = api.columns().count();\r\n");
      out.write("\r\n");
      out.write("                //         const html =\r\n");
      out.write("                //             '<tr class=\"start-kontrak-row\">' +\r\n");
      out.write("                //                 '<td colspan=\"' + totalCols + '\">' +\r\n");
      out.write("                //                     'START OF KONTRAK RINCI : ' + kontrak +\r\n");
      out.write("                //                 '</td>' +\r\n");
      out.write("                //             '</tr>';\r\n");
      out.write("\r\n");
      out.write("                //         $(refNode).before(html);\r\n");
      out.write("                //     }\r\n");
      out.write("\r\n");
      out.write("                //     function insertSubtotal(refNode, group, value) {\r\n");
      out.write("                //         if (!group) return;\r\n");
      out.write("\r\n");
      out.write("                //         const totalCols = api.columns().count();\r\n");
      out.write("                //         let html = '<tr class=\"subtotal-row fw-bold\">';\r\n");
      out.write("\r\n");
      out.write("                //         for (let i = 0; i < totalCols; i++) {\r\n");
      out.write("                //             if (i === 0) {\r\n");
      out.write("                //                 html += '<td>TOTAL ' + group + '</td>';\r\n");
      out.write("                //             } else if (i === colQtyIndex) {\r\n");
      out.write("                //                 html += '<td style=\"text-align:right; color:darkred;\">' + value + '</td>';\r\n");
      out.write("                //             } else {\r\n");
      out.write("                //                 html += '<td></td>';\r\n");
      out.write("                //             }\r\n");
      out.write("                //         }\r\n");
      out.write("\r\n");
      out.write("                //         html += '</tr>';\r\n");
      out.write("\r\n");
      out.write("                //         refNode ? $(refNode).before(html) : $tbody.append(html);\r\n");
      out.write("                //     }\r\n");
      out.write("\r\n");
      out.write("                //     function insertEndOfKontrak(refNode, kontrak) {\r\n");
      out.write("                //         if (!kontrak) return;\r\n");
      out.write("\r\n");
      out.write("                //         const totalCols = api.columns().count();\r\n");
      out.write("                //         const html =\r\n");
      out.write("                //             '<tr class=\"end-kontrak-row\">' +\r\n");
      out.write("                //                 '<td colspan=\"' + totalCols + '\">' +\r\n");
      out.write("                //                     'END OF KONTRAK RINCI : ' + kontrak +\r\n");
      out.write("                //                 '</td>' +\r\n");
      out.write("                //             '</tr>';\r\n");
      out.write("\r\n");
      out.write("                //         refNode ? $(refNode).before(html) : $tbody.append(html);\r\n");
      out.write("                //     }\r\n");
      out.write("                // },\r\n");
      out.write("\r\n");
      out.write("                lengthMenu: [[10, 100, 1000], [10, 100, 1000]]\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            // Simpan page sebelum search\r\n");
      out.write("            detailTable.on('page.dt', () => {\r\n");
      out.write("                if (!detailTable.search()) lastPageBeforeSearchDetail = detailTable.page();\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            // Force ke page 0 saat search\r\n");
      out.write("            detailTable.on('preXhr.dt', (e, settings, data) => {\r\n");
      out.write("                if (detailTable.search()) {\r\n");
      out.write("                    settings._iDisplayStart = 0;\r\n");
      out.write("                    data.start = 0;\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            // Kembali ke page sebelum search\r\n");
      out.write("            detailTable.on('search.dt', () => {\r\n");
      out.write("                if (!detailTable.search()) {\r\n");
      out.write("                    setTimeout(() => {\r\n");
      out.write("                        detailTable.page(lastPageBeforeSearchDetail).draw('page');\r\n");
      out.write("                    }, 300);\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("        });\r\n");
      out.write("       \r\n");
      out.write("        // ----------------------------------------------------------------------------\r\n");
      out.write("        // 1B-2) Export ke exel semua data MON Detail\r\n");
      out.write("        // ----------------------------------------------------------------------------\r\n");
      out.write("        // Fungsi format angka ribuan (lokal Indonesia)\r\n");
      out.write("        const formatRibuan = (angka) => new Intl.NumberFormat('id-ID').format(angka);\r\n");
      out.write("\r\n");
      out.write("        // Ambil nama UID/UIW PLN  dari DB\r\n");
      out.write("        async function fetchNamaUnitUPI(kd_dist) {\r\n");
      out.write("            const params = new URLSearchParams();\r\n");
      out.write("            params.append('act', 'getNamaUnitUPI');\r\n");
      out.write("            params.append('kd_dist', kd_dist);\r\n");
      out.write("\r\n");
      out.write("            const response = await fetch(getContextPath() + '/mon-pengerjaan-perprovupi', {\r\n");
      out.write("                method: 'POST',\r\n");
      out.write("                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n");
      out.write("                body: params.toString()\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            if (!response.ok) throw new Error(\"Gagal mengambil data UNITUPI\");\r\n");
      out.write("\r\n");
      out.write("            const json = await response.json();\r\n");
      out.write("            if (json.status !== 'success') throw new Error(\"Data UNITUPI tidak ditemukan\");\r\n");
      out.write("\r\n");
      out.write("            return json.data.NAMA_DIST || '';\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        /* =========================================================\r\n");
      out.write("        * HELPER\r\n");
      out.write("        * ========================================================= */\r\n");
      out.write("        function safeName(str) {\r\n");
      out.write("            return String(str || '')\r\n");
      out.write("                .replace(/[\\\\\\/:*?\"<>|]/g, '')\r\n");
      out.write("                .replace(/\\s+/g, '_')\r\n");
      out.write("                .toUpperCase();\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        function styleRow(row, fromCol, toCol, opt = {}) {\r\n");
      out.write("            for (let c = fromCol; c <= toCol; c++) {\r\n");
      out.write("                const cell = row.getCell(c);\r\n");
      out.write("\r\n");
      out.write("                cell.border = {\r\n");
      out.write("                    top: { style: 'thin' },\r\n");
      out.write("                    left: { style: 'thin' },\r\n");
      out.write("                    bottom: { style: 'thin' },\r\n");
      out.write("                    right: { style: 'thin' }\r\n");
      out.write("                };\r\n");
      out.write("\r\n");
      out.write("                if (opt.bold) {\r\n");
      out.write("                    cell.font = Object.assign({}, cell.font, { bold: true });\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                if (opt.fill) {\r\n");
      out.write("                    cell.fill = {\r\n");
      out.write("                        type: 'pattern',\r\n");
      out.write("                        pattern: 'solid',\r\n");
      out.write("                        fgColor: { argb: opt.fill }\r\n");
      out.write("                    };\r\n");
      out.write("                }\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        /* =========================================================\r\n");
      out.write("        * EXPORT EXCEL DETAIL\r\n");
      out.write("        * ========================================================= */\r\n");
      out.write("        $('#btnExportMonDftAllExcelOneSheet').on('click', async function () {\r\n");
      out.write("            const btn = $(this);\r\n");
      out.write("            $('#spinnerOverlay').show();\r\n");
      out.write("            btn.prop('disabled', true).text('Memuat...');\r\n");
      out.write("\r\n");
      out.write("            try {\r\n");
      out.write("                /* ================= PARAM ================= */\r\n");
      out.write("                const {\r\n");
      out.write("                    vtahun_laporan = '',\r\n");
      out.write("                    vkd_prov = '',\r\n");
      out.write("                    vinfolabel = ''\r\n");
      out.write("                } = detailFilterParams || {};\r\n");
      out.write("\r\n");
      out.write("                if (!vtahun_laporan || !vinfolabel || !vkd_prov) {\r\n");
      out.write("                    alert('Filter belum lengkap');\r\n");
      out.write("                    return;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                console.log(\"PARAM:\", { vtahun_laporan, vinfolabel, vkd_prov });\r\n");
      out.write("\r\n");
      out.write("                /* ================= AMBIL DATA ================= */\r\n");
      out.write("                const pageSize = 1000;\r\n");
      out.write("                let start = 0;\r\n");
      out.write("                let draw = 1;\r\n");
      out.write("                let dataAll = [];\r\n");
      out.write("\r\n");
      out.write("                while (true) {\r\n");
      out.write("                    const params = new URLSearchParams({\r\n");
      out.write("                        act: 'detailDatav3',\r\n");
      out.write("                        vtahun_laporan,\r\n");
      out.write("                        vkd_prov,\r\n");
      out.write("                        vinfolabel,\r\n");
      out.write("                        start,\r\n");
      out.write("                        length: pageSize,\r\n");
      out.write("                        draw: draw++\r\n");
      out.write("                    });\r\n");
      out.write("\r\n");
      out.write("                    const res = await fetch(getContextPath() + '/mon-pengerjaan-perprovupi', {\r\n");
      out.write("                        method: 'POST',\r\n");
      out.write("                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n");
      out.write("                        body: params.toString()\r\n");
      out.write("                    });\r\n");
      out.write("\r\n");
      out.write("                    if (!res.ok) throw new Error(`Server error: ");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${res.status}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("`);\r\n");
      out.write("                    const json = await res.json();\r\n");
      out.write("\r\n");
      out.write("                    if (!json.data || !json.data.length) break;\r\n");
      out.write("\r\n");
      out.write("                    dataAll.push(...json.data);\r\n");
      out.write("                    if (json.data.length < pageSize) break;\r\n");
      out.write("\r\n");
      out.write("                    start += pageSize;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                if (!dataAll.length) {\r\n");
      out.write("                    alert('Data kosong');\r\n");
      out.write("                    return;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                /* ================= SORT DATA ================= */\r\n");
      out.write("                const groupOrder = ['TIANG', 'KABEL', 'AKSESORIS'];\r\n");
      out.write("                dataAll.sort((a, b) => {\r\n");
      out.write("                    const indexA = groupOrder.indexOf(a.MATERIAL_GROUP || '') !== -1 ? groupOrder.indexOf(a.MATERIAL_GROUP) : groupOrder.length;\r\n");
      out.write("                    const indexB = groupOrder.indexOf(b.MATERIAL_GROUP || '') !== -1 ? groupOrder.indexOf(b.MATERIAL_GROUP) : groupOrder.length;\r\n");
      out.write("\r\n");
      out.write("                    if (indexA !== indexB) return indexA - indexB;\r\n");
      out.write("\r\n");
      out.write("                    return (a.NOMOR_KONTRAK_RINCI || '').localeCompare(b.NOMOR_KONTRAK_RINCI || '') ||\r\n");
      out.write("                        (a.NAMA_MATERIAL || '').localeCompare(b.NAMA_MATERIAL || '');\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                /* ================= WORKBOOK ================= */\r\n");
      out.write("                const workbook = new ExcelJS.Workbook();\r\n");
      out.write("                workbook.creator = 'Monitoring PLN';\r\n");
      out.write("                workbook.created = new Date();\r\n");
      out.write("\r\n");
      out.write("                const ws = workbook.addWorksheet('DETAIL', { properties: { outlineLevelRow: true } });\r\n");
      out.write("                ws.views = [{ showOutlineSymbols: true, state: 'frozen', ySplit: 7 }];\r\n");
      out.write("\r\n");
      out.write("                /* ================= STYLE HELPER ================= */\r\n");
      out.write("                function styleRow(row, startCol, endCol, opt = {}) {\r\n");
      out.write("                    for (let c = startCol; c <= endCol; c++) {\r\n");
      out.write("                        const cell = row.getCell(c);\r\n");
      out.write("                        cell.border = { top: { style: 'thin' }, left: { style: 'thin' }, bottom: { style: 'thin' }, right: { style: 'thin' } };\r\n");
      out.write("                        if (opt.bold) cell.font = { bold: true };\r\n");
      out.write("                        if (opt.fill) cell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: opt.fill } };\r\n");
      out.write("                    }\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                /* ================= HEADER ATAS ================= */\r\n");
      out.write("                const title = ws.addRow(['REKAP DETAIL PENGERJAAN']);\r\n");
      out.write("                ws.mergeCells(title.number, 1, title.number, 29);\r\n");
      out.write("                styleRow(title, 1, 29, { bold: true });\r\n");
      out.write("\r\n");
      out.write("                ws.addRows([\r\n");
      out.write("                    ['TAHUN', vtahun_laporan],\r\n");
      out.write("                    ['KETERANGAN', vinfolabel],\r\n");
      out.write("                    ['TANGGAL DOWNLOAD', new Date().toLocaleString('id-ID')],\r\n");
      out.write("                    []\r\n");
      out.write("                ]);\r\n");
      out.write("\r\n");
      out.write("                /* ================= HEADER TABEL ================= */\r\n");
      out.write("                const header = ws.addRow([\r\n");
      out.write("                    'NO','INFOLABEL','KATEGORI','TRANSMISI',\r\n");
      out.write("                    'MATERIAL_GROUP_ID','MATERIAL_GROUP','KODE_MATERIAL','NAMA_MATERIAL',\r\n");
      out.write("                    'JUMLAH_MDU','SATUAN','TAHUN','KD_PROV','PROVINSI',\r\n");
      out.write("                    'KD_KAB','KABUPATEN','KD_KEC','KECAMATAN',\r\n");
      out.write("                    'KD_KEL','DESA','UNITUPI','NAMA_UNITUPI',\r\n");
      out.write("                    'UNITAP','NAMA_UNITAP','UNITUP','NAMA_UNITUP',\r\n");
      out.write("                    'ID_PERENCANAAN','NOMOR_KONTRAK','NOMOR_KONTRAK_RINCI','KODE_PEMBANGUNAN'\r\n");
      out.write("                ]);\r\n");
      out.write("                styleRow(header, 1, 29, { bold: true, fill: 'E0E0E0' });\r\n");
      out.write("\r\n");
      out.write("                /* ================= DATA LOOP ================= */\r\n");
      out.write("                let no = 1, lastKontrak = null, lastGroup = null, subtotalGroup = 0;\r\n");
      out.write("\r\n");
      out.write("                for (const d of dataAll) {\r\n");
      out.write("                    const kontrak = d.NOMOR_KONTRAK_RINCI || '';\r\n");
      out.write("                    const group = d.MATERIAL_GROUP || '';\r\n");
      out.write("                    const qty = Number(d.JUMLAH_MDU) || 0;\r\n");
      out.write("\r\n");
      out.write("                    /* GANTI KONTRAK */\r\n");
      out.write("                    if (lastKontrak && kontrak !== lastKontrak) {\r\n");
      out.write("                        if (lastGroup) {\r\n");
      out.write("                            const rSub = ws.addRow([`SUBTOTAL ");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${lastGroup}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("`, '', '', '', '', '', '', '', subtotalGroup]);\r\n");
      out.write("                            for (let c = 2; c <= 29; c++) if (c !== 9) rSub.getCell(c).value = '';\r\n");
      out.write("                            styleRow(rSub, 1, 29, { bold: true, fill: 'FFF7CC' });\r\n");
      out.write("                            subtotalGroup = 0;\r\n");
      out.write("                        }\r\n");
      out.write("                        const rEnd = ws.addRow([`END KONTRAK RINCI : ");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${lastKontrak}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("`]);\r\n");
      out.write("                        ws.mergeCells(rEnd.number, 1, rEnd.number, 29);\r\n");
      out.write("                        styleRow(rEnd, 1, 29, { bold: true, fill: 'FFE0B2' });\r\n");
      out.write("                        rEnd.outlineLevel = 0;\r\n");
      out.write("                        lastGroup = null;\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("                    if (kontrak !== lastKontrak) {\r\n");
      out.write("                        const rStart = ws.addRow([`START KONTRAK RINCI : ");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${kontrak}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("`]);\r\n");
      out.write("                        ws.mergeCells(rStart.number, 1, rStart.number, 29);\r\n");
      out.write("                        styleRow(rStart, 1, 29, { bold: true, fill: 'E3F2FD' });\r\n");
      out.write("                        rStart.outlineLevel = 0;\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("                    /* GANTI GROUP */\r\n");
      out.write("                    if (lastGroup && group !== lastGroup) {\r\n");
      out.write("                        const rSub = ws.addRow([`SUBTOTAL ");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${lastGroup}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("`, '', '', '', '', '', '', '', subtotalGroup]);\r\n");
      out.write("                        for (let c = 2; c <= 29; c++) if (c !== 9) rSub.getCell(c).value = '';\r\n");
      out.write("                        styleRow(rSub, 1, 29, { bold: true, fill: 'FFF7CC' });\r\n");
      out.write("                        subtotalGroup = 0;\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("                    /* DETAIL ROW */\r\n");
      out.write("                    const r = ws.addRow([\r\n");
      out.write("                        no++, d.INFOLABEL, d.KATEGORI_PEMBANGUNAN, d.TRANSMISI,\r\n");
      out.write("                        d.MATERIAL_GROUP_ID, d.MATERIAL_GROUP, d.KODE_MATERIAL, d.NAMA_MATERIAL,\r\n");
      out.write("                        qty, d.SATUAN, d.TAHUN, d.KD_PROV, d.PROVINSI,\r\n");
      out.write("                        d.KD_KAB, d.KABUPATENKOTA, d.KD_KEC, d.KECAMATAN,\r\n");
      out.write("                        d.KD_KEL, d.DESAKELURAHAN, d.UNITUPI, d.NAMA_UNITUPI,\r\n");
      out.write("                        d.UNITAP, d.NAMA_UNITAP, d.UNITUP, d.NAMA_UNITUP,\r\n");
      out.write("                        d.ID_PERENCANAAN, d.NOMOR_KONTRAK, d.NOMOR_KONTRAK_RINCI, d.KODE_PEMBANGUNAN\r\n");
      out.write("                    ]);\r\n");
      out.write("                    styleRow(r, 1, 29);\r\n");
      out.write("                    r.outlineLevel = 1;\r\n");
      out.write("                    r.hidden = true;\r\n");
      out.write("\r\n");
      out.write("                    subtotalGroup += qty;\r\n");
      out.write("                    lastGroup = group;\r\n");
      out.write("                    lastKontrak = kontrak;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                /* SUBTOTAL & END KONTRAK TERAKHIR */\r\n");
      out.write("                if (lastGroup) {\r\n");
      out.write("                    const rSub = ws.addRow([`SUBTOTAL ");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${lastGroup}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("`, '', '', '', '', '', '', '', subtotalGroup]);\r\n");
      out.write("                    for (let c = 2; c <= 29; c++) if (c !== 9) rSub.getCell(c).value = '';\r\n");
      out.write("                    styleRow(rSub, 1, 29, { bold: true, fill: 'FFF7CC' });\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                if (lastKontrak) {\r\n");
      out.write("                    const rEnd = ws.addRow([`END KONTRAK RINCI : ");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${lastKontrak}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("`]);\r\n");
      out.write("                    ws.mergeCells(rEnd.number, 1, rEnd.number, 29);\r\n");
      out.write("                    styleRow(rEnd, 1, 29, { bold: true, fill: 'FFE0B2' });\r\n");
      out.write("                    rEnd.outlineLevel = 0;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                /* ================= SAVE ================= */\r\n");
      out.write("                const fileName = `DETAIL_");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${vtahun_laporan}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write('_');
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${vkd_prov}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write('_');
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${vinfolabel}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write(".xlsx`;\r\n");
      out.write("                const buffer = await workbook.xlsx.writeBuffer();\r\n");
      out.write("                saveAs(new Blob([buffer]), fileName);\r\n");
      out.write("\r\n");
      out.write("            } catch (e) {\r\n");
      out.write("                console.error(e);\r\n");
      out.write("                alert('Gagal export: ' + e.message);\r\n");
      out.write("            } finally {\r\n");
      out.write("                btn.prop('disabled', false).text('Export Excel');\r\n");
      out.write("                $('#spinnerOverlay').hide();\r\n");
      out.write("            }\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("    });\r\n");
      out.write("</script>\r\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
